export const __webpack_id__=481;export const __webpack_ids__=[481];export const __webpack_modules__={5983:(t,e,a)=>{var r=a(8323);console.log("AGRF Monthly data usage");const s={};r.d3.csv("/AGRF/disk_usage_2025-02-11.csv").then(t=>{console.log("disk_usage_2025-02-11.csv",t)});const n={};r.d3.json("/agrf_monthly_data").then(t=>t[1]).then(t=>{console.log("agrf_monthly_data",t),console.log(Object.keys(t[0])),function(t){console.log("drawReadLookingGraph",t);const e=t.map(t=>{const e=r.d3.timeParse("%Y-%m-%dT%H:%M:%S.%LZ")(t.start_timestamp),a=t.stop_timestamp?r.d3.timeParse("%Y-%m-%dT%H:%M:%S.%LZ")(t.stop_timestamp):new Date,s=r.d3.timeDay.offset(a,14),n=r.d3.timeDay.offset(a,60),i=r.d3.timeDay.offset(a,90),d=parseInt(t.preflight_bytes)||parseInt(t.bytes);return{name:t.contract_id,start:new Date(e),stop:new Date(a),clean:new Date(s),purge:new Date(n),expire:new Date(i),height:Math.max(1,d/1e11),size:d}}).sort((t,e)=>t.start-e.start);new r.t1({title:"Folders stored on VAST on any given date",element:"read_looking_graph",height:1e3,width:2e3,data:e}).scratchpad(t=>{const e=r.d3.scaleTime().range([0,t.innerWidth]).domain([r.d3.timeParse("%Y-%m-%d")("2024-09-01"),t.data[t.data.length-1].expire]),a=(r.d3.scaleLinear().range([t.innerHeight,0]).domain([0,r.d3.max(t.data,t=>parseInt(t.size))]),t.svg.append("g").classed("graph",!0).attr("transform",`translate(${t.margin.left},${t.margin.top})`));let s=0;const n=2.5;a.selectAll("g.folder").data(t.data).enter().append("g").attr("transform",(a,r)=>(s+=a.height,a.offset=s,`translate(${e(a.start)},${s/(t.data.length*n)*t.innerHeight})`)).classed("folder",!0).on("mouseover",function(t,e){console.log(e.name)}).each((t,a,s)=>{const i=r.d3.select(s[a]);i.append("rect").attr("x",0).attr("y",-t.height/n).attr("width",e(t.stop)-e(t.start)).attr("height",t.height/n).attr("fill","red").attr("opacity",.5),i.append("rect").attr("y",-t.height/n).attr("x",e(t.stop)-e(t.start)).attr("width",e(t.expire)-e(t.stop)).attr("height",t.height/n).attr("fill","steelblue").attr("opacity",.5)});const i=r.d3.axisBottom(e);t.svg.append("g").attr("transform",`translate(${t.margin.left},${t.innerHeight+t.margin.top})`).call(i),a.append("line").attr("x1",e(r.d3.timeParse("%Y-%m-%d")("2025-02-17"))).attr("x2",e(r.d3.timeParse("%Y-%m-%d")("2025-02-17"))).attr("y1",0).attr("y2",t.innerHeight).attr("stroke","black").attr("stroke-width",1)})}(t);var e=0,a=0;return t.forEach(t=>{if(t.bytes=parseInt(t.bytes),t.preflight_bytes=parseInt(t.preflight_bytes),t.size=Math.max(t.bytes,t.preflight_bytes),e+=t.size,a+=t.bytes,!t.stop_timestamp)return;const r=t.stop_timestamp.split("-");if(r[0]){const e=`${r[0]}-${r[1]}`;n[e]=n[e]||{disk_size:0,total_size:0,total_rows:0,rows:[]},n[e].rows.push(t),n[e].disk_size+=t.bytes,n[e].total_size+=t.size,n[e].total_rows+=1,n[e].human_readable_size=d(n[e].total_size)}}),console.log("Total data used",d(e)),console.log("Total disk used",d(a)),n}).then(t=>{console.log("monthly_data",t);const e=Object.entries(t).map(([t,e])=>({timestamp:r.d3.timeParse("%Y-%m")(t),month:t,rows:e.rows,disk_size:e.disk_size,total_size:e.total_size,total_rows:e.total_rows,human_readable_size:e.human_readable_size})).sort((t,e)=>t.timestamp-e.timestamp);new r.t1({title:"Monthly Data Usage (sent date) red = data on VAST",element:"data_per_month",data:e.slice(-6),nav:!1}).scratchpad(t=>{console.log("Chart",t),console.log(t.data);const a=r.d3.scaleTime().range([0,t.innerWidth]),s=r.d3.scaleLinear().range([t.innerHeight,0]);r.d3.line().x(t=>a(t.timestamp)).y(t=>s(t.total_size)),r.d3.line().x(t=>a(t.timestamp)).y(t=>s(t.disk_size)),a.domain([r.d3.timeMonth.offset(t.data[0].timestamp,-1),r.d3.timeMonth.offset(t.data[t.data.length-1].timestamp,1)]),s.domain([0,1.2*r.d3.max(t.data,t=>Math.max(t.total_size,t.disk_size))]);const n=r.d3.axisBottom(a),i=r.d3.axisLeft(s).tickFormat(t=>d(t));t.svg.append("g").attr("transform",`translate(${t.margin.left},${t.innerHeight+t.margin.top})`).call(n),t.svg.append("g").attr("transform",`translate(${t.margin.left},${t.margin.top})`).call(i);const l=(t.innerWidth-2*t.margin.left)/t.data.length;console.log("Drawing blue columns",t.data),t.plot.selectAll("rect.blue-total").data(t.data).enter().append("rect").classed("blue-total",!0).attr("x",t=>a(t.timestamp)-l/2).attr("y",t=>s(t.total_size)).attr("width",l).attr("height",e=>t.innerHeight-s(e.total_size)).attr("fill","steelblue"),t.plot.selectAll("rect.disk").data(t.data).enter().append("rect").attr("class","disk").attr("x",t=>a(t.timestamp)-l/2).attr("y",t=>s(t.disk_size)).attr("width",l).attr("height",e=>t.innerHeight-s(e.disk_size)).attr("fill","red"),t.plot.selectAll("text").data(t.data).enter().append("text").style("text-anchor","middle").attr("x",t=>a(t.timestamp)).attr("y",t=>s(t.total_size)).attr("dy","-0.1em").text(t=>t.human_readable_size),t.plot.selectAll("text.disk").data(t.data).enter().append("text").attr("class","disk").style("text-anchor","middle").attr("x",t=>a(t.timestamp)).attr("y",t=>s(t.disk_size)).attr("dy","0.8em").text(t=>d(t.disk_size));const o=t.data.reduce((t,e)=>t+e.total_size,0),p=t.data.reduce((t,e)=>t+e.disk_size,0),c=e.reduce((t,e)=>t+e.disk_size,0),h=t.svg.append("g").attr("transform","translate(-80,90)");h.append("rect").attr("x",t.innerWidth-100).attr("y",10).attr("width",220).attr("height",80).attr("fill","white").attr("stroke","black"),h.append("text").attr("x",t.innerWidth-80).attr("y",30).text(`Data seen here: ${d(o)}`),h.append("rect").attr("x",t.innerWidth-95).attr("y",20).attr("width",10).attr("height",10).attr("fill","steelblue"),h.append("text").attr("x",t.innerWidth-80).attr("y",50).text(`Data seen here: ${d(p)}`),h.append("rect").attr("x",t.innerWidth-95).attr("y",40).attr("width",10).attr("height",10).attr("fill","red"),h.append("text").attr("x",t.innerWidth-80).attr("y",70).text(`Total Data: ${d(c)}`),h.append("rect").attr("x",t.innerWidth-95).attr("y",60).attr("width",10).attr("height",10).attr("fill","red")})}),new r.t1({element:"contract_lifecycle",title:"Example Contract Lifecycle",nav:!1}).scratchpad(t=>{const e=r.d3.scaleLinear().range([t.innerHeight/2,0]).domain([0,5]),a=r.d3.scaleLinear().range([0,t.innerWidth]).domain([0,130]),s=[{label:"Demux",size:1,days:5,day:1,storage:"vast"},{label:"Analysis",size:2,days:14,day:6,storage:"vast"},{label:"Delivered to client",size:2,days:14,day:20,storage:"vast"},{label:"Backed up to AWS",size:1,days:90,day:34,storage:"aws"}],n=t.svg.append("g").attr("transform",`translate(${t.margin.left},${t.margin.top})`).classed("graph",!0);n.selectAll("rect").data(s).enter().append("rect").attr("x",(t,e)=>a(t.day)).attr("y",(t,a)=>e(t.size)).attr("width",t=>a(t.days)).attr("height",a=>t.innerHeight/2-e(a.size)).attr("fill",t=>"vast"===t.storage?"red":"steelblue").attr("opacity",.5).attr("stroke","black"),n.selectAll("text.rect-label").data(s).enter().append("g").classed("rect-label",!0).each((s,n,i)=>{const d=r.d3.select(i[n]);d.append("text").datum(s).attr("x",t=>(a(t.days)+a(t.day))/2).attr("y",e=>t.innerHeight/4-30+(n+1)%2*20).text(t=>t.label),d.append("line").datum(s).attr("x1",t=>(a(t.days)+a(t.day))/2).attr("x2",t=>(a(t.days)+a(t.day))/2).attr("y1",t.innerHeight/4-30+(n+1)%2*20).attr("y2",t=>e(t.size)).attr("stroke-dasharray","2,2").attr("stroke","grey")});const i=r.d3.axisBottom(a),d=r.d3.axisLeft(e);t.svg.append("g").attr("transform",`translate(${t.margin.left},${t.innerHeight/2+t.margin.top})`).call(i).append("text").attr("x",t.innerWidth/2).attr("y",40).text("Days").attr("text-anchor","middle").attr("fill","black").attr("font-size","1.5em"),t.svg.append("g").attr("transform",`translate(${t.margin.left},${t.margin.top})`).call(d).append("text").attr("transform","rotate(-90)").attr("x",-t.innerHeight/4).attr("y",-40).text("TeraBytes").attr("text-anchor","middle").attr("fill","black").attr("font-size","1.5em")}),r.d3.tsv("/AGRF/disk_usage_agrf.tsv").then(t=>(console.log(t),t.forEach((t,e)=>{s[t.run_id]=s[t.run_id]||{data:{},size:0},s[t.run_id].data[e]=t,s[t.run_id].size+=parseInt(t.bytes),s[t.run_id].human_readable_size=d(s[t.run_id].size)}),s)).then(t=>{var e=Object.entries(t).sort((t,e)=>e[1].size-t[1].size);r.d3.select("#runs table thead").append("tr").selectAll("th").data(["size","run_id","contracts"]).enter().append("th").text(t=>t),r.d3.select("#runs table tbody").selectAll("tr").data(e).enter().append("tr").attr("id",([t,e])=>`row-${t}`).each(([t,e])=>{var a=r.d3.select(`#row-${t}`);a.append("td").html(`${e.size}<br>${e.human_readable_size}`),a.append("td").html(`${t}<br><pre style='font-size:0.7em;padding:0 1em'>/data/Analysis/NovaSeqX/${t}</pre>`);var s=Object.entries(e.data),n=a.append("td").append("details");n.append("summary").text(`> ${s.length} contract folders`);var i=n.append("table"),d=i.append("thead").append("tr");d.append("th").text("demux_pk"),d.append("th").text("contract_id"),d.append("th").text("owner"),d.append("th").text("size"),d.append("th").text("date_sent"),i.append("tbody").selectAll("tr").data(s).enter().append("tr").attr("id",([t,e])=>`row-${t}`).each(([t,e])=>{var a=r.d3.select(`#row-${t}`);a.append("td").text(e.demux_pk),a.append("td").text(e.contract_id),a.append("td").text(e.user),a.append("td").text(e.size_human_readable),a.append("td").text(e.date_sent)})})});const i={};function d(t){let e=0;for(;t>=1024;)t/=1024,e++;return`${t.toFixed(2)} ${["B","KB","MB","GB","TB","PB"][e]}`}globalThis.displayFiles=function(t){console.log("Displaying files for",t);const e=r.d3.select("#files_table tbody").html("");let a=[],s=[],n=[];r.d3.json(i[t].full).then(e=>{i[t].full_data=e;const d=i[t];console.log(d);const l=d.contract_dir.replace("/data/Analysis/","");a=r._.concat(d.full_data.list.include.files,d.full_data.list.include.symlinks).map(([t,e,...a])=>`${l}/${e}/${t}`.replace("/./","/")).sort(),n=d.aws_files.list.include.map(t=>t.Key).sort(),s=r._.intersection(a,n);const o=r._.difference(n,a);return{original_only:r._.difference(a,n),aws_only:o,intersection:s}}).then(({original_only:t,aws_only:a,intersection:r})=>{console.log("Displaying files",{original_only:t,aws_only:a,intersection:r});const s=Math.max(t.length,a.length,r.length);for(let n=0;n<s;n++){const s=e.append("tr");s.append("td").text(t[n]||""),s.append("td").text(r[n]||""),s.append("td").text(a[n]||"")}})}}};import t from"./chart.js";import*as e from"./monthly_data.js";t.C(e),t(t.s=5983);