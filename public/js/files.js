"use strict";(self.webpackChunkdataviz=self.webpackChunkdataviz||[]).push([[664],{2182:(e,t,s)=>{s.d(t,{d:()=>r});var i=s(4345),a=s(7569);console.log("files.ts");const n={},l=["A22H3JVLT3.csv","B2272MKLT3.csv","CAGRF12711.csv","CAGRF220610939.csv","CAGRF23110233-9.csv","CAGRF24010007.csv","CAGRF24010125.csv","CAGRF24010169-1.csv","CAGRF24020097.csv","CAGRF24020290.csv","CAGRF12711-4.csv","20240124_LH00406_0051_B22J25VLT3-CAGRF12711.csv","CAGRF23101260.csv","CAGRF23110233-10.csv","CAGRF24010125-new.csv"],o=i.d3.scaleOrdinal().range(["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]).domain(["fastq","fastq.gz","txt","hist.txt","json","json.gz","bam","mate2","mate1","pairsam","sam","vcf","gvcf","tmp","bed","junction","log","pac","fa","bin","out"]);function r(e){const t=e.datum();t.data||(console.log("Error, no data on this node, creating one",t),t.data={filesize:0,path:t.id,name:t.id.split("/").pop()||t.id,filetype:"folder",filestatus:"keep",timestamp:""});const s=e.append("details"),a=s.append("ul"),n=s.append("ul");s.attr("open",(()=>t.depth<2||null)).on("toggle",(function(e,s){i.d3.select(this).attr("drawn")||(i.d3.select(this).attr("drawn",!0),(t.children||[]).sort(((e,t)=>t.value-e.value)).forEach((e=>{void 0!==e.children||e&&e.data&&"folder"===e.data.filetype?r(a.append("li").datum(e)):function(e){const t=e.datum();e.classed("file",!0).html(`<span class="filename">${t.data.name}</span>\n    <span class="fileStatus">${g(t)}</span>\n    <span class="filesize">${c(t.value)}</span>`)}(n.append("li").datum(e))})))})),function(e){const t=e.datum();e.html(`<span class="foldername">${t.data.name}</span>\n    <span class="fileStatus">${g(t)}</span>\n    <span class="filesize">${c(t.value)}</span>`).classed("folder",!0).attr("id",`directory-${(0,i.Ce)(t.id)}`).on("mouseover",(function(e,s){e.stopPropagation(),i.d3.select(`#folder-${(0,i.Ce)(t.id)}`).classed("mouseover",!0)})).on("mouseout",(function(e,s){i.d3.select(`#folder-${(0,i.Ce)(t.id)}`).classed("mouseover",!1)}))}(s.append("summary").datum(t))}function c(e,t=!0,s=!0){return t?s&&e>1099511627776?`${i.d3.format(".2f")(e/1099511627776)} TiB`:e>1073741824?`${i.d3.format(".2f")(e/1073741824)} GiB`:e>1048576?`${i.d3.format(".2f")(e/1048576)} MiB`:`${i.d3.format(".2f")(e/1024)} KiB`:s&&e>1e12?`${i.d3.format(".2f")(e/1e12)} TB`:e>1e9?`${i.d3.format(".2f")(e/1e9)} GB`:e>1e6?`${i.d3.format(".2f")(e/1e6)} MB`:`${i.d3.format(".2f")(e/1e3)} KB`}function d(e,t){const s=["fastq.gz","bam","bai","vcf","vcf.gz","hist.txt","gvcf","gvcf.gz"],[a,n]=Object.values(e).reduce((([e,t],i)=>(e={name:"total",count:e.count+i.count,filesize:e.filesize+i.filesize},s.includes(i.name)||(t={name:"misc files (not including: "+s.join(", ")+")",count:t.count+i.count,filesize:t.filesize+i.filesize}),[e,t])),[{name:"total",count:0,filesize:0},{name:"misc files (not including: "+s.join(", ")+")",count:0,filesize:0}]);i.d3.select("#legend table tbody").selectAll("tr").data([a,n,...Object.values(e).sort(((e,t)=>t.filesize-e.filesize))],(e=>e.name)).enter().append("tr").html((e=>{let s=t(e.name);return("total"===e.name||e.name.includes("misc files"))&&(s="transparent"),`<td style="background-color:${s}"></td><td>${e.name}</td><td>${e.count}</td><td>${c(e.filesize)}</td>`}))}i.d3.select("#jsonButtons").selectAll("button").data(["CAGRF23101260.json","CAGRF23110233-10.json","CAGRF24010125.json"]).enter().append("button").attr("id",(e=>e.split(".")[0])).text((e=>e.split(".")[0])).on("click",(function(e,t){console.log("click",t),i.d3.json(`/AGRF/new/${t}`).then((e=>e.files.map((e=>p({filesize:e.Size||0,timestamp:e.LastModified,path:e.Key,name:e.Key.split("/").pop()||e.Key,filetype:e.Key.split(".").pop().toLowerCase(),filestatus:"keep"}))).filter((e=>null!==e)))).then(i.d3.stratify().path((e=>e.path))).then((e=>{console.log(e),e.sum((e=>e?e.filesize:0)),r(i.d3.select("#filestructure").datum(e));const s=new i.t1({title:t,element:"treemap",margin:10}).initTreemap({hierarchy:e,target:"filesize",color:o});d(n,s.color)}))})),i.d3.select("#buttons").selectAll("button").data(l).enter().append("button").attr("id",(e=>e.split(".")[0])).text((e=>e.split(".")[0])).on("click",(function(e,t){console.log("click",t),i.d3.text(`/AGRF/${t}`).then((e=>i.d3.csvParseRows(e).map((e=>{let[t,s,i,a,n,...l]=e;e.length<5&&([t,s,i,...l]=e);const o=l.join(),r=o.split("/"),c=r.pop()||r.pop();let d=c.split(".").pop();if("/"===o.slice(-1))d="folder";else if(-1!==["tar","gz","zip","txt","bai","out","err","log"].indexOf(d)){const e=c.split(".");e.length>2&&(d=e.slice(-2).join("."))}return p({filesize:parseInt(t),rsync:s,timestamp:i,path:o,name:c,filetype:d,filestatus:null})})))).then(i.d3.stratify().path((e=>e.path))).then((e=>{e.sum((e=>e.filesize)),r(i.d3.select("#filestructure").datum(e));const s=new i.t1({title:t,element:"treemap",margin:10}).initTreemap({hierarchy:e,target:"filesize",color:o});d(n,s.color)}))}));const f=window.location.hash;function p(e){const t=n[e.filetype]=n[e.filetype]||{name:e.filetype,list:[],count:0,filesize:0};return t.count+=1,t.filesize+=e.filesize,t.list.push(e),e}l.map((e=>e.split(".")[0])).indexOf(f)&&a(f).trigger("click"),"#aws"===f&&(console.log("#aws selected, trying to process aws.tsv"),i.d3.json("/AGRF/aws.json").then((e=>e.Contents.map((e=>{const t={filesize:e.Size,timestamp:e.LastModified,path:e.Key,name:e.Key.split("/").pop(),filetype:e.Key.split(".").pop().toLowerCase(),filestatus:"keep"};return p(t),t})))).then(i.d3.stratify().path((e=>e.path))).then((e=>{e.each((e=>{e.data||(e.data={timestamp:"",path:e.id,name:e.id.split("/").pop()||e.id,filetype:"folder",filestatus:"keep",filesize:0})})).sum((e=>e.filesize)),e.sum((e=>e?e.filesize:0)),r(i.d3.select("#filestructure").datum(e)),d(n,i.d3.scaleOrdinal(i.d3.schemeCategory10))}))),"#rsync"===f&&(console.log("#rsync selected, trying to process 20240709_LH00620_0027_A22KVHVLT3.csv"),i.d3.text("/AGRF/20240709_LH00620_0027_A22KVHVLT3.csv").then((e=>i.d3.csvParseRows(e).map((e=>{const[t,s,i,a,n,...l]=e,o=l.join(),r=o.split("/"),c=r.pop()||r.pop();let d=c.split(".").pop();if("/"===o.slice(-1))d="folder";else if(-1!==["tar","gz","zip","txt","bai","out","err","log"].indexOf(d)){const e=c.split(".");e.length>2&&(d=e.slice(-2).join("."))}return p({filesize:parseInt(t),rsync:s,timestamp:i,path:o,name:c,filetype:d,filestatus:null})})))).then(i.d3.stratify().path((e=>e.path))).then((e=>{console.log("Here is the hierarchy",e),console.log("There are this many filetypes:",Object.entries(n).length),console.log("Filetypes",n),e.sum((e=>e?e.filesize:0)),r(i.d3.select("#filestructure").datum(e)),new i.t1({element:"treemap",margin:10}).initTreemap({hierarchy:e,target:"filesize",color:o}),d(n,i.d3.scaleOrdinal(i.d3.schemeCategory10))})));var m={},u=["node_modules","bower_components","AppData","Media/Games","Cache","Frameworks","Contents","/lib/","plugins/",".lrdata/","/.git/","/.metadata/","/common/","/.retroarch/","/iPhoto Library/Masters/","/.meteor/","/src/","/iPhoto Library/Database","/."];u.forEach((e=>{m[e]={name:e,total_filesize:0,files:[]}})),"#pi4"===f&&(console.log("#pi4 selected, trying to process pi4_audit.txt"),i.d3.text("/AGRF/pi4_audit.txt").then((e=>i.d3.csvParseRows(e).map((([e,t,s,i])=>{const a={filesize:parseInt(e),rsync:t,timestamp:s,path:i,name:i.split("/").pop(),filetype:i.split(".").pop().toLowerCase(),filestatus:"keep"},n=u.find((e=>-1!==i.indexOf(e)));return n?(m[n].total_filesize+=a.filesize,m[n].files.push(a),null):a})).filter((e=>null!==e)))).then(i.d3.stratify().path((e=>e.path))).then((e=>{console.log("Here is the hierarchy",e),console.log("Filetypes",n),e.sum((e=>e?e.filesize:0)),i.d3.select("#filestructure"),new i.t1({element:"treemap",margin:10}).initTreemap({hierarchy:e,target:"filesize",color:o})}))),"#home"===f&&(console.log("#home selected, trying to process file_audit_full.csv"),i.d3.text("/AGRF/file_audit_full.csv").then((e=>i.d3.csvParseRows(e).map((e=>{const[t,s,...i]=e,a=parseInt(t),n=i.join(),l=n.split("/"),o=l.pop()||l.pop();let r="unknown";return"/"===n.slice(-1)?r="folder":-1!==o.indexOf(".")&&(r=o.split(".").pop().toLowerCase()),l.length>8||n.length>512||"folder"!==r&&a<52428800||-1!==n.indexOf("node_modules")||-1!==n.indexOf("bower_components")||-1!==n.indexOf("/.")||-1!==n.indexOf("AppData")||-1!==n.indexOf("Media/Games")||-1!==n.indexOf("Cache")||-1!==n.indexOf("Frameworks")||-1!==n.indexOf("Contents")||-1!==n.indexOf("/lib/")||-1!==n.indexOf("plugins/")||-1!==n.indexOf(".lrdata/")||-1!==n.indexOf("/.git/")||-1!==n.indexOf("/.metadata/")||-1!==n.indexOf("/common/")||-1!==n.indexOf("/.retroarch/")||-1!==n.indexOf("/iPhoto Library/Masters/")||-1!==n.indexOf("/.meteor/")||-1!==n.indexOf("/src/")||-1!==n.indexOf("/iPhoto Library/Database")?null:p({filesize:a,timestamp:s,path:n,name:o,filetype:r,filestatus:"keep"})})).filter((e=>null!==e)))).then(i.d3.stratify().path((e=>e.path))).then((e=>{console.log("Here is the hierarchy",e),console.log("There are this many filetypes:",Object.entries(n).length),console.log("Filetypes",n),e.sum((e=>e?e.filesize:0)),r(i.d3.select("#filestructure").datum(e)),new i.t1({element:"treemap",margin:10}).initTreemap({hierarchy:e,target:"filesize",color:o}),d(n,i.d3.scaleOrdinal(i.d3.schemeCategory10))})));const h={secondary_analysis:[/^secondary_analysis\/Results.*/,/^secondary_analysis\/Intermediate.*/,/^secondary_analysis\/commands.*.txt$/,/^secondary_analysis\/parameters.*.txt$/]};function g(e){return e.data?{keep:'<span class="status green">Keep</span>',delete:'<span class="status red">Ignore</span>',mixed:'<span class="status yellow">Mixed</span>'}[e.data.filestatus||y(e)]:(console.log("Error, no data on this node",e),"")}function y(e){const t=e.data;if(!t.filestatus)if("folder"===t.filetype&&e.children){const s=e.children.map((e=>y(e))),i=[...new Set(s)];0===s.length?t.filestatus="delete":1===i.length?t.filestatus=i[0]:t.filestatus="mixed"}else t.filestatus="keep",Object.entries(h).forEach((([e,s])=>{t.path.includes(e)&&(s.find((e=>e.test(t.path)))||(t.filestatus="delete"))}));return t.filestatus}}},e=>{e(e.s=2182)}]);