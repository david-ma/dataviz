export const __webpack_id__=982;export const __webpack_ids__=[982];export const __webpack_modules__={3120:(e,t,a)=>{var n=a(8323),r=(a(7843),a(7569)),i=a(6580);!function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,r,i=[],o=!0,s=!1;try{for(a=a.call(e);!(o=(n=a.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){s=!0,r=e}finally{try{o||null==a.return||a.return()}finally{if(s)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var o=25,s={};function l(e){try{if("array"===e.store_type)return!1;if("local"!==e.store_type&&"session"!==e.store_type&&void 0!==e.store_type)return!1;var t="test";return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(e){return!1}}function d(e){return"PEDIGREE_"+e.btn_target+"_"}function c(e){return s[d(e)]}function u(e,t){return"local"===e.store_type?localStorage.getItem(t):sessionStorage.getItem(t)}function f(e,t,a){return"local"===e.store_type?localStorage.setItem(t,a):sessionStorage.setItem(t,a)}function h(e){for(var t=d(e),a="local"===e.store_type?localStorage:sessionStorage,n=[],r=0;r<a.length;r++)0==a.key(r).indexOf(t)&&n.push(a.key(r));for(var i=0;i<n.length;i++)a.removeItem(n[i])}function p(e){var t;return null!=(t=l(e)?u(e,d(e)+"COUNT"):s[d(e)+"COUNT"])?t:0}function m(e,t){l(e)?f(e,d(e)+"COUNT",t):s[d(e)+"COUNT"]=t}function g(e){if(e.dataset){var t=p(e);l(e)?f(e,d(e)+t,JSON.stringify(e.dataset)):(console.warn("Local storage not found/supported for this browser!",e.store_type),o=500,void 0===c(e)&&(s[d(e)]=[]),c(e).push(JSON.stringify(e.dataset))),t<o?t++:t=0,m(e,t)}}function _(e){if(!l(e))return c(e)&&c(e).length>0?c(e).length:-1;for(var t=o;t>0;t--)if(null!==u(e,d(e)+(t-1)))return t;return-1}function v(e){var t=p(e)-1;return-1==t&&(t=o),l(e)?JSON.parse(u(e,d(e)+t)):c(e)?JSON.parse(c(e)[t]):void 0}function y(e,t){if(void 0===t&&(t=p(e)-2),t<0){var a=a(e);t=a<o?a-1:o-1}return m(e,t+1),l(e)?JSON.parse(u(e,d(e)+t)):JSON.parse(c(e)[t])}function x(e,t){return void 0===t&&(t=p(e)),t>=o&&(t=0),m(e,parseInt(t)+1),l(e)?JSON.parse(u(e,d(e)+t)):JSON.parse(c(e)[t])}function b(e){l(e)&&function(e){"local"===e.store_type?localStorage.clear():sessionStorage.clear()}(e),s={}}function w(e,t,a,n){if(l(e)){var r="local"===e.store_type?localStorage:sessionStorage;t?(f(e,d(e)+"_X",t),f(e,d(e)+"_Y",a)):(r.removeItem(d(e)+"_X"),r.removeItem(d(e)+"_Y"));var i=d(e)+"_ZOOM";n?f(e,i,n):r.removeItem(i)}}function z(e){if(!l(e)||null===localStorage.getItem(d(e)+"_X")&&null===sessionStorage.getItem(d(e)+"_X"))return[null,null];var t=[parseInt(u(e,d(e)+"_X")),parseInt(u(e,d(e)+"_Y"))];return null!==u(e,d(e)+"_ZOOM")&&t.push(parseFloat(u(e,d(e)+"_ZOOM"))),t}var k=Object.freeze({__proto__:null,clear_pedigree_data:h,get_count:p,init_cache:g,nstore:_,current:v,last:function(e){if(l(e))for(var t=o;t>0;t--){var a=u(e,d(e)+(t-1));if(null!==a)return m(e,t),JSON.parse(a)}else{var n=c(e);if(n)return JSON.parse(n(n.length-1))}},previous:y,next:x,clear:b,setposition:w,getposition:z});function A(){var e=navigator.userAgent;return e.indexOf("MSIE ")>-1||e.indexOf("Trident/")>-1}function O(){return navigator.userAgent.match(/Edge/g)}function E(e){e[0].id&&e.sort(function(e,t){return e.id&&t.id?e.id>t.id?1:t.id>e.id?-1:0:0});for(var t=["id","parent_node"],a=[],n=0;n<e.length;n++){var r={};for(var i in e[n])-1==t.indexOf(i)&&(r[i]=e[n][i]);a.push(r)}return a}function F(e,t){var a=!1;return t&&r.each(t,function(t,n){if(0===t.indexOf(e+"_")||t===e)return a=!0}),a}function I(e,t,a,n,i){a?r('<div id="msgDialog">'+t+"</div>").dialog({modal:!0,title:e,width:350,buttons:{Yes:function(){r(this).dialog("close"),a(n,i)},No:function(){r(this).dialog("close")}}}):r('<div id="msgDialog">'+t+"</div>").dialog({title:e,width:350,buttons:[{text:"OK",click:function(){r(this).dialog("close")}}]})}function S(e){for(var t="",a=0;a<e;a++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(Math.floor(52*Math.random()));return t}function D(e,a,n,i,o){"undefined"===t(a.children)&&(a.children=P(e.dataset,a)),"undefined"===t(i)&&(i=[],o=1);var s=Z(n),l=[];return r.each(a.children,function(t,a){r.each(e.dataset,function(t,n){if((a.name===n.mother||a.name===n.father)&&void 0===a.id){var r=te(s,n.mother),i=te(s,n.father);r=void 0!==r?r:te(e.dataset,n.mother),i=void 0!==i?i:te(e.dataset,n.father),function(e,t,a){for(var n=0;n<e.length;n++)if(e[n].mother===t&&e[n].father===a)return!0;return!1}(l,r,i)||l.push({mother:r,father:i})}})}),r.merge(i,l),r.each(l,function(t,n){var r=n.mother,i=n.father;r.children=[];var l={name:S(4),hidden:!0,parent:null,father:i,mother:r,children:P(e.dataset,r,i)},d=J(e.dataset,r.name),c=J(e.dataset,i.name);"id"in i||"id"in r||(o=M(a.children,o));var u=function(e,t,a){for(var n=t,r=a;"mother"in e[n]&&"mother"in e[r]&&!("noparents"in e[n])&&!("noparents"in e[r]);)n=J(e,e[n].mother),r=J(e,e[r].mother);return{midx:n,fidx:r}}(e.dataset,d,c);u.fidx<u.midx?(i.id=o++,l.id=o++,r.id=o++):(r.id=o++,l.id=o++,i.id=o++),o=N(r,l,o,s,e),o=N(i,l,o,s,e),a.children.push(l)}),o=M(a.children,o),r.each(a.children,function(t,a){o=D(e,a,n,i,o)[1]}),[i,o]}function N(e,t,a,n,r){if("parent_node"in e?e.parent_node.push(t):e.parent_node=[t],e.mztwin||e.dztwins)for(var i=H(r.dataset,e),o=0;o<i.length;o++){var s=te(n,i[o].name);s&&(s.id=a++)}return a}function M(e,t){return e.sort(function(e,t){return e.mztwin&&t.mztwin&&e.mztwin==t.mztwin||e.dztwin&&t.dztwin&&e.dztwin==t.dztwin?0:e.mztwin||t.mztwin||e.dztwin||t.dztwin?1:0}),r.each(e,function(e,a){void 0===a.id&&(a.id=t++)}),t}function C(e){return"undefined"!==t(r(e).attr("proband"))&&!1!==r(e).attr("proband")}function T(e,t){for(var a=0;a<t.length;a++)-1==r.inArray(t[a],e)&&e.push(t[a])}function U(e,t,a){if(-1!=r.inArray(t.name,e)){T(e,L(a,t));var n=q(a,t);r.each(n,function(t,n){-1==r.inArray(n.name,e)&&(e.push(n.name),T(e,L(a,n)))})}}function L(e,t){for(var a=[],n=0;n<e.length;n++){var i=e[n];t.name===i.mother&&-1==r.inArray(i.father,a)?a.push(i.father):t.name===i.father&&-1==r.inArray(i.mother,a)&&a.push(i.mother)}return a}function R(e){var t=e[B(e)];if(!t){if(console.warn("No target defined"),0==e.length)throw"empty pedigree data set";t=e[0]}for(var a=[t.name],n=!0,i=0;n&&i<200;){i++;var o=a.length;r.each(e,function(n,i){if(-1!=r.inArray(i.name,a)){for(var o=L(e,i),s=i.name===t.name||!i.noparents,l=0;l<o.length;l++)te(e,o[l]).noparents||(s=!0);s&&(i.mother&&-1==r.inArray(i.mother,a)&&a.push(i.mother),i.father&&-1==r.inArray(i.father,a)&&a.push(i.father))}else!i.noparents&&(i.mother&&-1!=r.inArray(i.mother,a)||i.father&&-1!=r.inArray(i.father,a))&&a.push(i.name);U(a,i,e)}),n=o!=a.length}var s=r.map(e,function(e,t){return e.name});return r.map(s,function(e,t){return-1==r.inArray(e,a)?e:null})}function B(e){var t;return r.each(e,function(e,a){if(C(a))return t=e}),t}function P(e,t,a){var n=[],i=[];return"F"===t.sex&&r.each(e,function(e,o){t.name===o.mother&&(a&&a.name!=o.father||-1===r.inArray(o.name,i)&&(n.push(o),i.push(o.name)))}),n}function G(e,t,a){return void 0===t||!t.mother||t.noparents?[]:r.map(e,function(e,n){return e.name===t.name||"noparents"in e||!e.mother||e.mother!==t.mother||e.father!==t.father||a&&e.sex!=a?null:e})}function j(e,t,a){return r.map(e,function(e,n){return e.name===t.name||"noparents"in e||!e.mother||e.mother!==t.mother||e.father!==t.father||a&&e.sex!=a?null:e})}function H(e,t){var a=G(e,t),n=t.mztwin?"mztwin":"dztwin";return r.map(a,function(e,a){return e.name!==t.name&&e[n]==t[n]?e:null})}function $(e,t){return r.map(e,function(e,a){return e.name!==t.name&&"noparents"in e&&e.mother===t.mother&&e.father===t.father?e:null})}function q(e,t,a){return r.map(e,function(e,n){return"noparents"in e||e.mother!==t.name&&e.father!==t.name||a&&e.sex!==a?null:e})}function Y(e,t){for(var a=J(e,t),n=1;a>=0&&("mother"in e[a]||e[a].top_level);)a=J(e,e[a].mother),n++;return n}function J(e,t){var a=-1;return r.each(e,function(e,n){if(t===n.name)return a=e}),a}function X(e,t,a){return r.map(e,function(e,n){return e.depth!=t||e.data.hidden||-1!=r.inArray(e.data.name,a)?null:e}).sort(function(e,t){return e.x-t.x})}function V(e,t){for(var a=[],n=0;n<t.length;n++)a.push({mother:te(e,t[n].mother.name),father:te(e,t[n].father.name)});return a}function K(e,t){var a=[];return function t(n){n.data&&(n=n.data),"mother"in n&&"father"in n&&!("noparents"in n)&&(t(te(e,n.mother)),t(te(e,n.father))),a.push(n)}(t),a}function W(e,t,a){if(e.depth!==t.depth)return!0;var n=K(a.dataset,e),i=K(a.dataset,t),o=r.map(n,function(e,t){return e.name}),s=r.map(i,function(e,t){return e.name}),l=!1;return r.each(o,function(e,t){if(-1!==r.inArray(t,s))return l=!0,!1}),l}function Z(e){var t=[];return function e(a){a.children&&a.children.forEach(e),t.push(a)}(e),t}function Q(e,t,a){function n(i){if(i.children&&(i.children.forEach(n),void 0!==i.data.father)){var o=te(a,i.data.father.name),s=te(a,i.data.mother.name),l=(o.x+s.x)/2;if(ee(e,t.descendants(),l,i.depth,[i.data.name]))(i.x<o.x&&i.x<s.x||i.x>o.x&&i.x>s.x)&&(i.x=l);else{i.x=l;var d=i.x-l;if(2==i.children.length&&(i.children[0].data.hidden||i.children[1].data.hidden)){if(!i.children[0].data.hidden||!i.children[1].data.hidden){var c=i.children[0].data.hidden?i.children[1]:i.children[0],u=i.children[0].data.hidden?i.children[0]:i.children[1];(c.x<u.x&&l<u.x||c.x>u.x&&l>u.x)&&!ee(e,t.descendants(),l,c.depth,[c.data.name])&&(c.x=l)}}else if(1!=i.children.length||i.children[0].data.hidden){if(0!==d&&!function(e,t,a,n){for(var i=t.descendants(),o=r.map(i,function(e,t){return e.data.name}),s=n.descendants(),l=0;l<i.length;l++){var d=i[l];if(t.data.name!==d.data.name&&ee(e,s,d.x-a,d.depth,o))return!0}return!1}(e,i,d,t))if(1==i.children.length)i.children[0].x=l;else{var f=i.descendants();e.DEBUG&&console.log("ADJUSTING "+i.data.name+" NO. DESCENDANTS "+f.length+" diff="+d);for(var h=0;h<f.length;h++)i.data.name!==f[h].data.name&&(f[h].x-=d)}}else ee(e,t.descendants(),l,i.children[0].depth,[i.children[0].data.name])||(i.children[0].x=l)}}}n(t),n(t)}function ee(e,t,a,n,i){for(var o=0;o<t.length;o++)if(n==t[o].depth&&-1==r.inArray(t[o].data.name,i)&&Math.abs(a-t[o].x)<1.15*e.symbol_size)return!0;return!1}function te(e,t){for(var a=0;a<e.length;a++){if(e[a].data&&t===e[a].data.name)return e[a];if(t===e[a].name)return e[a]}}function ae(e,t,a,n){var i=E(v(e)),o=te(i,t);if(o){if(r.isArray(a)||(a=[a]),n)for(var s=0;s<a.length;s++){var l=a[s];if(l in o&&1===a.length){if(o[l]===n)return;try{if(JSON.stringify(o[l])===JSON.stringify(n))return}catch(e){}}o[l]=n}else{for(var d=!1,c=0;c<a.length;c++){var u=a[c];u in o&&(delete o[u],d=!0)}if(!d)return}ut(i,o),e.dataset=i,st(e)}else console.warn("No person defined")}function ne(e){var t;r("#pedigree_data").remove(),r("body").append("<div id='pedigree_data'></div>");for(var a=0;a<e.dataset.length;a++){var n="<div class='row'><strong class='col-md-1 text-right'>"+e.dataset[a].name+"</strong><div class='col-md-11'>";for(t in e.dataset[a])"name"!==t&&("parent"===t?n+="<span>"+t+":"+e.dataset[a][t].name+"; </span>":"children"===t?void 0!==e.dataset[a][t][0]&&(n+="<span>"+t+":"+e.dataset[a][t][0].name+"; </span>"):n+="<span>"+t+":"+e.dataset[a][t]+"; </span>");r("#pedigree_data").append(n+"</div></div>")}for(t in r("#pedigree_data").append("<br /><br />"),e)"dataset"!==t&&r("#pedigree_data").append("<span>"+t+":"+e[t]+"; </span>")}var re,ie=Object.freeze({__proto__:null,isIE:A,isEdge:O,copy_dataset:E,prefixInObj:F,getFormattedDate:function(e){var t=new Date;return e?("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2):t.getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2)+" "+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2)},messages:I,validate_age_yob:function(e,t,a){var n=(new Date).getFullYear(),r=parseInt(e)+parseInt(t);return(1==a||Math.abs(n-r)<=1)&&n>=r},capitaliseFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},makeid:S,buildTree:D,isProband:C,setProband:function(e,t,a){r.each(e,function(e,n){t===n.name?n.proband=a:delete n.proband})},get_partners:L,unconnected:R,getProbandIndex:B,getChildren:P,getSiblings:G,getAllSiblings:j,getTwins:H,getAdoptedSiblings:$,getAllChildren:q,getDepth:Y,getIdxByName:J,getNodesAtDepth:X,linkNodes:V,ancestors:K,consanguity:W,flatten:Z,adjust_coords:Q,overlap:ee,getNodeByName:te,urlParam:function(e){var t=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return null===t?null:t[1]||0},proband_attr:function(e,t,a){ae(e,e.dataset[B(e.dataset)].name,t,a)},node_attr:ae,proband_add_child:function(e,t,a,n,r){var i=E(v(e)),o=i[B(i)];if(o){var s=lt(i,o,t,1)[0];return s.age=a,s.yob=n,void 0!==r&&(s.breastfeeding=r),e.dataset=i,st(e),s.name}console.warn("No proband defined")},delete_node_by_name:function(e,t){var a=E(v(e)),n=te(v(e),t);n?mt(a,n,e,function(e,t){e.dataset=t,st(e)}):console.warn("No node defined")},exists:function(e,t){return void 0!==te(v(e),t)},print_opts:ne});function oe(e,t){var a=e.symbol_size/2,n=2.5*-e.symbol_size;re=i.zoom().scaleExtent([e.zoomIn,e.zoomOut]).filter(function(){return!((!e.zoomSrc||-1===e.zoomSrc.indexOf("wheel"))&&i.event.type&&"wheel"===i.event.type||"dblclick"===i.event.type||i.event.button)}).on("zoom",function(){!function(e){e.DEBUG&&console.log("zoom",i.event,i.event.transform);var t=i.event.transform,a=t.k&&1!==t.k?t.k:void 0;w(e,t.x,t.y,a),i.select("#"+e.targetDiv).select(".diagram").attr("transform","translate("+t.x+","+t.y+")"+(a?" scale("+a+")":""))}(e)}),t.call(re);var r=z(e),o=3==r.length?r[2]:1,s=null!==r[0]?r[0]/o:a*o,l=null!==r[1]?r[1]/o:n*o,d=i.zoomIdentity.scale(o).translate(s,l);t.call(re.transform,d)}function se(e,t){i.select("#"+e.targetDiv).select("svg").transition().duration(50).call(re.scaleBy,t)}function le(e){var t=function(e){var t=de(e);return{wid:Math.abs(t.xmax-t.xmin),hgt:Math.abs(t.ymax-t.ymin)}}(e),a=i.select("#"+e.targetDiv).select("svg"),n=function(e){return{w:e.node().clientWidth,h:e.node().clientHeight}}(a),r=(n.w-2*e.symbol_size)/n.w/Math.max(t.wid/n.w,t.hgt/n.h);r<e.zoomIn&&re.scaleExtent([r,e.zoomOut]);var o=function(e){var t=de(e);return{x:t.xmin+(t.xmax-t.xmin)/2,y:t.ymin+(t.ymax-t.ymin)/2}}(e);a.call(re.translateTo,o.x,o.y),setTimeout(function(){a.transition().duration(700).call(re.scaleTo,r)},400)}function de(e){var t=i.select("#"+e.targetDiv).select(".diagram"),a=Number.MAX_VALUE,n=-1e6,r=Number.MAX_VALUE,o=-1e6,s=e.symbol_size/2;return t.selectAll("g").each(function(e,t){e.x&&"hidden_root"!==e.data.name&&(e.x-s<a&&(a=e.x-s),e.x+s>n&&(n=e.x+s),e.y-s<r&&(r=e.y-s),e.y+s>o&&(o=e.y+s))}),{xmin:a,xmax:n,ymin:r,ymax:o}}function ce(e){var t=r.extend({btn_target:"pedigree_history"},e),a=[{fa:"fa-undo pull-left",title:"undo"},{fa:"fa-repeat pull-left",title:"redo"},{fa:"fa-refresh pull-left",title:"reset"}];a.push({fa:"fa-crosshairs pull-right",title:"scale-to-fit"}),t.zoomSrc&&t.zoomSrc.indexOf("button")>-1&&(1!=t.zoomOut&&a.push({fa:"fa-minus-circle pull-right",title:"zoom-out"}),1!=t.zoomIn&&a.push({fa:"fa-plus-circle pull-right",title:"zoom-in"})),a.push({fa:"fa-arrows-alt pull-right",title:"fullscreen"});for(var n="",i=0;i<a.length;i++)n+="<span>",n+='&nbsp;<i class="fa fa-lg '+a[i].fa+'" '+("fa-arrows-alt pull-right"==a[i].fa?'id="fullscreen" ':"")+' aria-hidden="true" title="'+a[i].title+'"></i>',n+="</span>";r("#"+t.btn_target).append(n),function(e){r(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",function(t){var a=v(e);null!=a&&(e.dataset=a),st(e),setTimeout(function(){le(e)},500)}),r("#fullscreen").on("click",function(t){if(ue())document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{var a=r("#"+e.targetDiv)[0];a.requestFullscreen?a.requestFullscreen():document.documentElement.mozRequestFullScreen?a.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen?a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):document.documentElement.msRequestFullscreen&&a.msRequestFullscreen()}});var t=0;function a(){se(e,1.05)}function n(){se(e,.95)}r(".fa-plus-circle, .fa-minus-circle").on("mousedown",function(){t=setInterval(r(this).hasClass("fa-plus-circle")?a:n,50)}).on("mouseup mouseleave",function(){clearInterval(t)}),r("#"+e.btn_target).on("click",function(t){if(t.stopPropagation(),r(t.target).hasClass("disabled"))return!1;r(t.target).hasClass("fa-undo")?(e.dataset=y(e),r("#"+e.targetDiv).empty(),et(e)):r(t.target).hasClass("fa-repeat")?(e.dataset=x(e),r("#"+e.targetDiv).empty(),et(e)):r(t.target).hasClass("fa-refresh")?r('<div id="msgDialog">Resetting the pedigree may result in loss of some data.</div>').dialog({title:"Confirm Reset",resizable:!1,height:"auto",width:400,modal:!0,buttons:{Continue:function(){!function(e,t){var a;if(t){var n=E(v(e));(a=n[B(n)]).name="ch1",a.mother="f21",a.father="m21",h(e)}else a={name:"ch1",sex:"F",mother:"f21",father:"m21",proband:!0,status:"0",display_name:"me"},b(e);delete e.dataset;var i=r("input[name='default_fam']:checked");i.length>0&&"extended2"==i.val()?e.dataset=[{name:"wZA",sex:"M",top_level:!0,status:"0",display_name:"paternal grandfather"},{name:"MAk",sex:"F",top_level:!0,status:"0",display_name:"paternal grandmother"},{name:"zwB",sex:"M",top_level:!0,status:"0",display_name:"maternal grandfather"},{name:"dOH",sex:"F",top_level:!0,status:"0",display_name:"maternal grandmother"},{name:"MKg",sex:"F",mother:"MAk",father:"wZA",status:"0",display_name:"paternal aunt"},{name:"xsm",sex:"M",mother:"MAk",father:"wZA",status:"0",display_name:"paternal uncle"},{name:"m21",sex:"M",mother:"MAk",father:"wZA",status:"0",display_name:"father"},{name:"f21",sex:"F",mother:"dOH",father:"zwB",status:"0",display_name:"mother"},{name:"aOH",sex:"F",mother:"f21",father:"m21",status:"0",display_name:"sister"},{name:"Vha",sex:"M",mother:"f21",father:"m21",status:"0",display_name:"brother"},{name:"Spj",sex:"M",mother:"f21",father:"m21",noparents:!0,status:"0",display_name:"partner"},a,{name:"zhk",sex:"F",mother:"ch1",father:"Spj",status:"0",display_name:"daughter"},{name:"Knx",display_name:"son",sex:"M",mother:"ch1",father:"Spj",status:"0"},{name:"uuc",display_name:"maternal aunt",sex:"F",mother:"dOH",father:"zwB",status:"0"},{name:"xIw",display_name:"maternal uncle",sex:"M",mother:"dOH",father:"zwB",status:"0"}]:i.length>0&&"extended1"==i.val()?e.dataset=[{name:"m21",sex:"M",mother:null,father:null,status:"0",display_name:"father",noparents:!0},{name:"f21",sex:"F",mother:null,father:null,status:"0",display_name:"mother",noparents:!0},{name:"aOH",sex:"F",mother:"f21",father:"m21",status:"0",display_name:"sister"},{name:"Vha",sex:"M",mother:"f21",father:"m21",status:"0",display_name:"brother"},{name:"Spj",sex:"M",mother:"f21",father:"m21",noparents:!0,status:"0",display_name:"partner"},a,{name:"zhk",sex:"F",mother:"ch1",father:"Spj",status:"0",display_name:"daughter"},{name:"Knx",display_name:"son",sex:"M",mother:"ch1",father:"Spj",status:"0"}]:e.dataset=[{name:"m21",display_name:"father",sex:"M",top_level:!0},{name:"f21",display_name:"mother",sex:"F",top_level:!0},a],st(e)}(e,e.keep_proband_on_reset),r(this).dialog("close")},Cancel:function(){r(this).dialog("close")}}}):r(t.target).hasClass("fa-crosshairs")&&le(e),r(document).trigger("fhChange",[e])})}(t)}function ue(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}var fe={breast_cancer:"breast_cancer_diagnosis_age",breast_cancer2:"breast_cancer2_diagnosis_age",ovarian_cancer:"ovarian_cancer_diagnosis_age",prostate_cancer:"prostate_cancer_diagnosis_age",pancreatic_cancer:"pancreatic_cancer_diagnosis_age"},he=["brca1","brca2","palb2","atm","chek2","rad51d","rad51c","brip1"],pe=["er","pr","her2","ck14","ck56"],me=new Object;function ge(e){return 0!==r.trim(r("#"+e).val()).length}function _e(){var e={};return ge("breast_prs_a")&&ge("breast_prs_z")&&(e.breast_cancer_prs={alpha:parseFloat(r("#breast_prs_a").val()),zscore:parseFloat(r("#breast_prs_z").val()),percent:parseFloat(r("#breast_prs_percent").val())}),ge("ovarian_prs_a")&&ge("ovarian_prs_z")&&(e.ovarian_cancer_prs={alpha:parseFloat(r("#ovarian_prs_a").val()),zscore:parseFloat(r("#ovarian_prs_z").val()),percent:parseFloat(r("#ovarian_prs_percent").val())}),console.log(e),function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(e)?0:e}function ve(e){for(var t=e.trim().split("\n"),a=[],n=[],i=function(e){var i=t[e].trim();if(0===i.indexOf("##")){if(0===i.indexOf("##CanRisk")&&i.indexOf(";")>-1)for(var o=i.split(";"),s=1;s<o.length;s++)2===o[s].split("=").length&&n.push(o[s]);return-1===i.indexOf("CanRisk")&&0!==i.indexOf("##FamID")&&n.push(i.replace("##","")),"continue"}var l=/\t/;i.indexOf("\t")<0&&(l=/\s+/,console.log("NOT TAB DELIM"));var d=r.map(i.split(l),function(e,t){return e.trim()});if(d.length>1){var c={famid:d[0],display_name:d[1],name:d[3],sex:d[6],status:d[8]};1==d[2]&&(c.proband=!0),"0"!==d[4]&&(c.father=d[4]),"0"!==d[5]&&(c.mother=d[5]),"0"!==d[7]&&(c.mztwin=d[7]),"0"!==d[9]&&(c.age=d[9]),"0"!==d[10]&&(c.yob=d[10]);var u=11;r.each(fe,function(e,t){"0"!==d[u]&&(c[t]=d[u]),u++}),"0"!==d[u++]&&(c.ashkenazi=1);for(var f=0;f<he.length;f++){var h=d[u].split(":");"0"!==h[0]&&("S"!==h[0]&&"T"!==h[0]||"P"!==h[1]&&"N"!==h[1]?console.warn("UNRECOGNISED GENE TEST ON LINE "+(e+1)+": "+h[0]+" "+h[1]):c[he[f]+"_gene_test"]={type:h[0],result:h[1]}),u++}for(var p=d[u].split(":"),m=0;m<p.length;m++)"0"!==p[m]&&("N"===p[m]||"P"===p[m]?c[pe[m]+"_bc_pathology"]=p[m]:console.warn("UNRECOGNISED PATHOLOGY ON LINE "+(e+1)+": "+pe[m]+" "+p[m]));a.unshift(c)}},o=0;o<t.length;o++)i(o);return[n,a]}function ye(e,t,a,n){var i="##CanRisk 1.0";t||(t="XXXX"),a&&(i+=a),void 0===n&&(n=!0);var o=r.map(e,function(e,t){return"exclude"in e&&e.exclude?e.name:null}),s=B(e),l="F";if(s&&(l=e[s].sex),"M"!==l){var d=xe("menarche_age"),c=xe("parity"),u=xe("age_of_first_live_birth"),f=xe("oral_contraception"),h=xe("mht"),p=xe("bmi"),m=xe("alcohol_intake"),g=xe("age_of_menopause"),_=xe("mammographic_density"),v=xe("height"),y=xe("Age_Tubal_ligation"),x=xe("endometriosis");void 0!==d&&(i+="\n##menarche="+d),void 0!==c&&(i+="\n##parity="+c),void 0!==u&&(i+="\n##first_live_birth="+u),void 0!==f&&(i+="\n##oc_use="+f),void 0!==h&&(i+="\n##mht_use="+h),void 0!==p&&(i+="\n##BMI="+p),void 0!==m&&(i+="\n##alcohol="+m),void 0!==g&&(i+="\n##menopause="+g),void 0!==_&&(i+="\n##birads="+_),void 0!==v&&(i+="\n##height="+v),void 0!==y&&(i+="n"!==y&&"N"!==y?"\n##TL=Y":"\n##TL=N"),void 0!==x&&(i+="\n##endo="+x)}i+="\n##FamID\tName\tTarget\tIndivID\tFathID\tMothID\tSex\tMZtwin\tDead\tAge\tYob\tBC1\tBC2\tOC\tPRO\tPAN\tAshkn\tBRCA1\tBRCA2\tPALB2\tATM\tCHEK2\tRAD51D\tRAD51C\tBRIP1\tER:PR:HER2:CK14:CK56";for(var b=function(a){var s=e[a];if(-1!=r.inArray(s.name,o))return console.log("EXCLUDE: "+s.name),"continue";i+="\n"+t+"\t",i+=n?a+"\t":(s.display_name?s.display_name:"NA")+"\t",i+=("proband"in s?"1":0)+"\t",i+=s.name+"\t",i+=("father"in s&&!("noparents"in s)&&-1==r.inArray(s.mother,o)?s.father:0)+"\t",i+=("mother"in s&&!("noparents"in s)&&-1==r.inArray(s.mother,o)?s.mother:0)+"\t",i+=s.sex+"\t",i+=("mztwin"in s?s.mztwin:0)+"\t",i+=("status"in s?s.status:0)+"\t",i+=("age"in s?s.age:0)+"\t",i+=("yob"in s?s.yob:0)+"\t",r.each(fe,function(e,t){i+=t in s?(t in s?s[t]:"AU")+"\t":"0\t"}),i+=("ashkenazi"in s?s.ashkenazi:0)+"\t";for(var l=0;l<he.length;l++)he[l]+"_gene_test"in s&&"-"!==s[he[l]+"_gene_test"].type&&"-"!==s[he[l]+"_gene_test"].result?(i+=s[he[l]+"_gene_test"].type+":",i+=s[he[l]+"_gene_test"].result+"\t"):i+="0:0\t";for(var d=0;d<pe.length;d++)pe[d]+"_bc_pathology"in s?(i+=s[pe[d]+"_bc_pathology"],console.log("pathology "+s[pe[d]+"_bc_pathology"]+" for "+s.display_name)):i+="0",d<pe.length-1&&(i+=":")},w=0;w<e.length;w++)b(w);return console.log(i,me),i}function xe(e){var t=be(e);if(t in me)return me[t]}function be(e){return window.location.pathname.split("/").filter(function(e){return!!e}).pop()+"::"+e}var we=Object.freeze({__proto__:null,cancers:fe,genetic_test:he,pathology_tests:pe,get_meta:function(){var e,t=function(){var e="";return r("#A6_4_3_check").parent().hasClass("off")||(e+=";OVARY2=y"),r("#A6_4_7_check").parent().hasClass("off")||(e+=";MAST2=y"),e}();try{(e=_e()).breast_cancer_prs&&0!==e.breast_cancer_prs.alpha&&0!==e.breast_cancer_prs.zscore&&(t+="\n##PRS_BC=alpha="+e.breast_cancer_prs.alpha+",zscore="+e.breast_cancer_prs.zscore),e.ovarian_cancer_prs&&0!==e.ovarian_cancer_prs.alpha&&0!==e.ovarian_cancer_prs.zscore&&(t+="\n##PRS_OC=alpha="+e.ovarian_cancer_prs.alpha+",zscore="+e.ovarian_cancer_prs.zscore)}catch(t){console.warn("PRS",e)}return t},get_non_anon_pedigree:function(e,t){return ye(e,void 0,t,!1)},hasInput:ge,get_prs_values:_e,readCanRiskV1:ve,get_pedigree:ye,show_risk_factor_store:function(){console.log("RISK_FACTOR_STORE::"),r.each(me,function(e,t){console.log(e+" : "+t)})},save_risk_factor:function(e,t){me[be(e)]=t},get_risk_factor:xe,remove_risk_factor:function(e){delete me[be(e)]},store_name:be});function ze(e){r("#load").change(function(t){!function(e,t){var n=e.target.files[0];if(n){var i,o=new FileReader;o.onload=function(e){t.DEBUG&&console.log(e.target.result);try{if(0===e.target.result.indexOf("BOADICEA import pedigree file format 4.0"))t.dataset=De(e.target.result,4),Ie(t);else if(0===e.target.result.indexOf("BOADICEA import pedigree file format 2.0"))t.dataset=De(e.target.result,2),Ie(t);else if(0===e.target.result.indexOf("##")&&-1!==e.target.result.indexOf("CanRisk")){var n=function(e){var t=a(ve(e),2),n=t[0],r=t[1];try{return[n,Ne(r)]}catch(e){return console.error(e),[n,r]}}(e.target.result);i=n[0],t.dataset=n[1],Ie(t)}else try{t.dataset=JSON.parse(e.target.result)}catch(a){t.dataset=Se(e.target.result)}at(t)}catch(t){return console.error(t,e.target.result),void I("File Error",t.message?t.message:t)}console.log(t.dataset);try{w(t),st(t),console.log(i),r(document).trigger("riskfactorChange",[t,i]),r(document).trigger("fhChange",[t]);try{acc_FamHist_ticked(),acc_FamHist_Leave(),RESULT.FLAG_FAMILY_MODAL=!0}catch(e){}}catch(e){I("File Error",e.message?e.message:e)}},o.onerror=function(e){I("File Error","File could not be read! Code "+e.target.error.code)},o.readAsText(n)}else console.error("File could not be read!");r("#load")[0].value=""}(t,e)}),r("#save").click(function(t){!function(e){Fe(e,JSON.stringify(v(e)))}(e)}),r("#print").click(function(t){Ee(Ae(e))}),r("#svg_download").click(function(t){Oe(Ae(e))}),r("#png_download").click(function(e){var t=ke(r("svg"),"pedigree");r.when.apply(r,[t]).done(function(){var e=function(e){return r.grep(e,function(e){return e&&"pedigree"==e.name})[0]}(arguments);if(O()||A()){var t="<img src='"+e.img+"' alt='canvas image'/>";window.open().document.write(t)}else{var a=document.createElement("a");a.href=e.img,a.download="plot.png",a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}})})}function ke(e,t,a){var n={iscanvg:!1,resolution:1,img_type:"image/png"};if(a||(a=n),r.each(n,function(e,t){e in a||(a[e]=t)}),0===e.find(".pdf-white-bg").length){var o=i.select(e.get(0));o.append("rect").attr("width","100%").attr("height","100%").attr("class","pdf-white-bg").attr("fill","white"),o.select(".pdf-white-bg").lower()}var s,l=r.Deferred();void 0!==window.XMLSerializer?s=(new XMLSerializer).serializeToString(e.get(0)):void 0!==e.xml&&(s=e.get(0).xml);var d="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(s))),c=document.createElement("canvas");c.width=e.width()*a.resolution,c.height=e.height()*a.resolution;var u=c.getContext("2d"),f=document.createElement("img");return f.onload=function(){A()?(s=(s=s.replace(/ font-size="\d?.\d*em"/g,"")).replace(/<text /g,'<text font-size="12px" '),canvg.Canvg.fromString(u,s,{scaleWidth:c.width,scaleHeight:c.height,ignoreDimensions:!0}).start(),console.log(t,a.img_type,"use canvg to create image")):(u.drawImage(f,0,0,c.width,c.height),console.log(t,a.img_type)),l.resolve({name:t,resolution:a.resolution,img:c.toDataURL(a.img_type,1),w:c.width,h:c.height})},f.src=d,l.promise()}function Ae(e){var t=v(e);null!=t&&(e.dataset=t);var a=ot(e),n=r("<div></div>"),i=r("#"+e.targetDiv).find("svg").clone().appendTo(n),o=515,s=757;if(e.width<a.width||e.height<a.height||a.width>o||a.height>s){var l=a.width,d=a.height+100,c=1;if(a.width>o||a.height>s){a.width>o&&(l=o),a.height>s&&(d=s);var u=l/a.width,f=d/a.height;c=u<f?u:f}i.attr("width",l),i.attr("height",d);var h=1.5*-e.symbol_size*c;i.find(".diagram").attr("transform","translate(0, "+h+") scale("+c+")")}return n}function Oe(e){var t=document.createElement("a");t.href="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e.html()))),t.download="plot.svg",t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Ee(e,t){e.constructor!==Array&&(e=[e]);for(var a=.9*r(window).width(),n=r(window).height()-10,i=["/static/css/canrisk.css","https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"],o=window.open("","PrintMap","width="+a+",height="+n),s="",l=0;l<i.length;l++)s+='<link href="'+i[l]+'" rel="stylesheet" type="text/css" media="all">';s+="<style>body {font-size: "+r("body").css("font-size")+";}</style>";for(var d="",c=0;c<e.length;c++)0===c&&t&&(d+=t),d+=r(e[c]).html(),c<e.length-1&&(d+='<div class="page-break"> </div>');o.document.write(s),o.document.write(d),o.document.close(),o.focus(),setTimeout(function(){o.print(),o.close()},300)}function Fe(e,t,a,n){e.DEBUG&&console.log(t),a||(a="ped.txt"),n||(n="text/plain");var r=new Blob([t],{type:n});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(r,a);else{var i=document.createElement("a"),o=URL.createObjectURL(r);i.href=o,i.download=a,document.body.appendChild(i),i.click(),setTimeout(function(){document.body.removeChild(i),window.URL.revokeObjectURL(o)},0)}}function Ie(e){r.each(e.dataset,function(e,t){if(!t.hidden&&"M"===t.sex&&!C(t)&&t[fe.breast_cancer2]){var a="Male family member ("+t.display_name+") with contralateral breast cancer found. Please note that as the risk models do not take this into account the second breast cancer is ignored.";console.error(a),delete t[fe.breast_cancer2],I("Warning",a)}})}function Se(e){for(var t,a=e.trim().split("\n"),n=[],i=0;i<a.length;i++){var o=r.map(a[i].trim().split(/\s+/),function(e,t){return e.trim()});if(o.length<5)throw"unknown format";var s="1"==o[4]?"M":"2"==o[4]?"F":"U",l={famid:o[0],display_name:o[1],name:o[1],sex:s};if("0"!==o[2]&&(l.father=o[2]),"0"!==o[3]&&(l.mother=o[3]),void 0!==t&&t!==l.famid){console.error("multiple family IDs found only using famid = "+t);break}if("2"==o[5]&&(l.affected=2),o.length>6){l.alleles="";for(var d=6;d<o.length;d+=2)l.alleles+=o[d]+"/"+o[d+1]+";"}n.unshift(l),t=o[0]}return Ne(n)}function De(e,t){for(var a=e.trim().split("\n"),n=[],i=function(e){var i=r.map(a[e].trim().split(/\s+/),function(e,t){return e.trim()});if(i.length>1){var o={famid:i[0],display_name:i[1],name:i[3],sex:i[6],status:i[8]};1==i[2]&&(o.proband=!0),"0"!==i[4]&&(o.father=i[4]),"0"!==i[5]&&(o.mother=i[5]),"0"!==i[7]&&(o.mztwin=i[7]),"0"!==i[9]&&(o.age=i[9]),"0"!==i[10]&&(o.yob=i[10]);var s=11;if(r.each(fe,function(e,t){"0"!==i[s]&&(o[t]=i[s]),s++}),4===t){"0"!==i[s++]&&(o.ashkenazi=1);for(var l=0;l<5;l++)"0"!==i[(s+=2)-2]&&("S"!==i[s-2]&&"T"!==i[s-2]||"P"!==i[s-1]&&"N"!==i[s-1]?console.warn("UNRECOGNISED GENE TEST ON LINE "+(e+1)+": "+i[s-2]+" "+i[s-1]):o[he[l]+"_gene_test"]={type:i[s-2],result:i[s-1]})}else 2===t&&("0"!==i[(s+=2)-2]&&("S"===i[s-2]||"T"===i[s-2]?"N"===i[s-1]?(o.brca1_gene_test={type:i[s-2],result:"N"},o.brca2_gene_test={type:i[s-2],result:"N"}):"1"===i[s-1]?(o.brca1_gene_test={type:i[s-2],result:"P"},o.brca2_gene_test={type:i[s-2],result:"N"}):"2"===i[s-1]?(o.brca1_gene_test={type:i[s-2],result:"N"},o.brca2_gene_test={type:i[s-2],result:"P"}):"3"===i[s-1]&&(o.brca1_gene_test={type:i[s-2],result:"P"},o.brca2_gene_test={type:i[s-2],result:"P"}):console.warn("UNRECOGNISED GENE TEST ON LINE "+(e+1)+": "+i[s-2]+" "+i[s-1])),"0"!==i[s++]&&(o.ashkenazi=1));for(var d=0;d<pe.length;d++)"0"!==i[s]&&("N"===i[s]||"P"===i[s]?o[pe[d]+"_bc_pathology"]=i[s]:console.warn("UNRECOGNISED PATHOLOGY ON LINE "+(e+1)+": "+pe[d]+" "+i[s])),s++;n.unshift(o)}},o=2;o<a.length;o++)i(o);try{return Ne(n)}catch(e){return console.error(e),n}}function Ne(e){for(var t=0;t<2;t++)for(var a=0;a<e.length;a++)Ce(r=J(n=e,e[a].name),n[r].level?n[r].level:0,n);for(var n,r,i=0,o=0;o<e.length;o++)e[o].level&&e[o].level>i&&(i=e[o].level);for(var s=0;s<e.length;s++)if(1==Y(e,e[s].name))if(e[s].level&&e[s].level==i)e[s].top_level=!0;else{e[s].noparents=!0;var l=Me(e,e[s]);if(l>-1&&e[l].mother&&(e[s].mother=e[l].mother,e[s].father=e[l].father),!e[s].mother)for(var d=0;d<e.length;d++)e[s].level==e[d].level-1&&(l=Me(e,e[d]))>-1&&(e[s].mother="F"===e[d].sex?e[d].name:e[l].name,e[s].father="M"===e[d].sex?e[d].name:e[l].name)}else delete e[s].top_level;return e}function Me(e,t){for(var a=0;a<e.length;a++){var n=e[a];if(t.name===n.mother)return J(e,n.father);if(t.name===n.father)return J(e,n.mother)}return-1}function Ce(e,t,a){var n=["mother","father"];t++;for(var r=0;r<n.length;r++){var i=J(a,a[e][n[r]]);if(i>=0){var o=a[J(a,a[e].mother)],s=a[J(a,a[e].father)];(!a[i].level||a[i].level<t)&&(o.level=t,s.level=t),o.level<s.level?o.level=s.level:s.level<o.level&&(s.level=o.level),Ce(i,t,a)}}}var Te=Object.freeze({__proto__:null,add:ze,svg2img:ke,copy_svg:function(e){var t=Ae(e),a=i.select(t.get(0));return a.selectAll(".popup_selection, .indi_rect, .addsibling, .addpartner, .addchild, .addparents, .delete, .line_drag_selection").remove(),a.selectAll("text").filter(function(){return 0===i.select(this).text().length}).remove(),r(function(e){var t=function(e,t){var a,n=[],r=0;for(t.lastIndex=0;a=t.exec(e);){if(++r>400)return console.error("getMatches: counter exceeded 800"),-1;n.push(a),t.lastIndex===a.index&&t.lastIndex++}return n}(e,/url\((&quot;|"|'){0,1}#(.*?)(&quot;|"|'){0,1}\)/g);return-1===t?"ERROR DISPLAYING PEDIGREE":(r.each(t,function(t,a){var n=a[1]?a[1]:"",r=a[2],i='id="'+r+'"',o="url\\("+n+"#"+r+n+"\\)",s=r+S(2);e=(e=e.replace(new RegExp(i,"g"),'id="'+s+'"')).replace(new RegExp(o,"g"),"url(#"+s+")")}),e)}(t.html()))},svg_download:Oe,print:Ee,save_file:Fe,readLinkage:Se,readBoadiceaV4:De});function Ue(e){r("#age_yob_lock").removeClass("fa-lock fa-unlock-alt"),1==e?r("#age_yob_lock").addClass("fa-unlock-alt"):r("#age_yob_lock").addClass("fa-lock"),r("#id_age_"+e).removeClass("hidden"),r("#id_age_"+(1==e?"0":"1")).addClass("hidden")}function Le(e){r("#orig_ashk").is(":checked")?r.each(e,function(e,t){t.proband&&(t.ashkenazi=1)}):r.each(e,function(e,t){delete t.ashkenazi})}function Re(e){var t=v(e),a=r("#id_name").val(),n=E(t),i=te(n,a);if(i){r("#"+e.targetDiv).empty();var o=r("#id_yob_0").val();o&&""!==o?i.yob=o:delete i.yob;var s=r("#id_status").find("input[type='radio']:checked");s.length>0&&(i.status=s.val());for(var l=["miscarriage","adopted_in","adopted_out","termination","stillbirth"],d=0;d<l.length;d++){var c=l[d],u=r("#id_"+c);u.length>0&&(console.log(u.is(":checked")),u.is(":checked")?i[c]=!0:delete i[c])}var f=r("#id_sex").find("input[type='radio']:checked");f.length>0&&(i.sex=f.val(),Pe(i)),Le(n),r("#id_approx").is(":checked")?i.approx_diagnosis_age=!0:delete i.approx_diagnosis_age,r("#person_details select[name*='_diagnosis_age']:visible, #person_details input[type=text]:visible, #person_details input[type=number]:visible").each(function(){var e=this.name.indexOf("_diagnosis_age")>-1?this.name.substring(0,this.name.length-2):this.name;if(r(this).val()){var t=r(this).val();e.indexOf("_diagnosis_age")>-1&&r("#id_approx").is(":checked")&&(t=Ge(t)),i[e]=t}else delete i[e]}),r('#person_details input[type="checkbox"][name$="cancer"],input[type="checkbox"][name$="cancer2"]').each(function(){this.checked?i[r(this).attr("name")]=!0:delete i[r(this).attr("name")]}),r('#person_details select[name$="_bc_pathology"]').each(function(){"-"!==r(this).val()?i[r(this).attr("name")]=r(this).val():delete i[r(this).attr("name")]}),r('#person_details select[name$="_gene_test"]').each(function(){if("-"!==r(this).val()){var e=r('select[name="'+r(this).attr("name")+'_result"]');i[r(this).attr("name")]={type:r(this).val(),result:r(e).val()}}else delete i[r(this).attr("name")]});try{r("#person_details").find("form").valid()}catch(e){console.warn("valid() not found")}ut(n,i),e.dataset=n,st(e)}else console.warn("person not found when saving details")}function Be(){r("#id_approx").is(":checked")?(r("[id$='_diagnosis_age_0']").each(function(e){if(""!==r(this).val()){var t=this.name.substring(0,this.name.length-2);r("#id_"+t+"_1").val(Ge(r(this).val())).prop("selected",!0)}}),r("[id$='_diagnosis_age_0']").hide(),r("[id$='_diagnosis_age_1']").show()):(r("[id$='_diagnosis_age_1']").each(function(e){if(""!==r(this).val()){var t=this.name.substring(0,this.name.length-2);r("#id_"+t+"_0").val(r(this).val())}}),r("[id$='_diagnosis_age_0']").show(),r("[id$='_diagnosis_age_1']").hide())}function Pe(e){r("#cancer .row").show(),"M"===e.sex?(delete e.ovarian_cancer_diagnosis_age,r("[id^='id_ovarian_cancer_diagnosis_age']").closest(".row").hide(),r("[id^='id_breast_cancer2_diagnosis_age']").prop("disabled",!0)):"F"===e.sex&&(delete e.prostate_cancer_diagnosis_age,r("[id^='id_prostate_cancer_diagnosis_age']").closest(".row").hide(),r("[id^='id_breast_cancer2_diagnosis_age']").prop("disabled",!1))}function Ge(e){var t=10*Math.round((e-1)/10);return e<t?t-5:t+5}r(document).on("fhChange",function(e,t){try{var a=r("#id_name").val();void 0===te(v(t),a)?r("form > fieldset").prop("disabled",!0):r("form > fieldset").prop("disabled",!1)}catch(e){console.warn(e)}});var je,He,$e=Object.freeze({__proto__:null,updateStatus:Ue,nodeclick:function(e){for(var a in r("form > fieldset").prop("disabled",!1),r("#person_details").find("input[type=text], input[type=number]").val(""),r("#person_details select").val("").prop("selected",!0),"M"===e.sex||"F"===e.sex?r('input[name=sex][value="'+e.sex+'"]').prop("checked",!0):r("input[name=sex]").prop("checked",!1),Pe(e),"status"in e||(e.status=0),r('input[name=status][value="'+e.status+'"]').prop("checked",!0),Ue(e.status),"proband"in e?(r("#id_proband").prop("checked",e.proband),r("#id_proband").prop("disabled",!0)):(r("#id_proband").prop("checked",!1),r("#id_proband").prop("disabled",!("yob"in e))),"exclude"in e?r("#id_exclude").prop("checked",e.exclude):r("#id_exclude").prop("checked",!1),"yob"in e?r("#id_yob_0").val(e.yob):r("#id_yob_0").val("-"),r('select[name$="_bc_pathology"]').val("-"),r('select[name*="_gene_test"]').val("-"),r("input[id^='id_sex_']").prop("disabled",!(!e.parent_node||"U"===e.sex)),r("select[id$='_bc_pathology']").prop("disabled","M"===e.sex||"F"===e.sex&&!("breast_cancer_diagnosis_age"in e)),r("#id_approx").prop("checked",!!e.approx_diagnosis_age),Be(),e)"proband"!==a&&"sex"!==a&&(r("#id_"+a).length?-1!==a.indexOf("_gene_test")&&null!==e[a]&&"object"===t(e[a])?(r("#id_"+a).val(e[a].type),r("#id_"+a+"_result").val(e[a].result)):r("#id_"+a).val(e[a]):-1!==a.indexOf("_diagnosis_age")&&(r("#id_approx").is(":checked")?r("#id_"+a+"_1").val(Ge(e[a])).prop("selected",!0):r("#id_"+a+"_0").val(e[a])));try{r("#person_details").find("form").valid()}catch(e){console.warn("valid() not found")}},save_ashkn:function(e){var t=E(v(e));Le(t),e.dataset=t,st(e)},save:Re,update_diagnosis_age_widget:Be});function qe(e,t){var a=parseInt(r("body").css("font-size")),n=i.select(".diagram");n.append("rect").attr("class","popup_selection").attr("rx",6).attr("ry",6).attr("transform","translate(-1000,-100)").style("opacity",0).attr("width",7.9*a).attr("height",2*a).style("stroke","darkgrey").attr("fill","white");var o=n.append("text").attr("font-family","FontAwesome").style("opacity",0).attr("font-size","1.em").attr("class","popup_selection fa-lg fa-square persontype").attr("transform","translate(-1000,-100)").attr("x",a/3).attr("y",1.5*a).text(" ").append("svg:title").text("add male"),s=n.append("text").attr("font-family","FontAwesome").style("opacity",0).attr("font-size","1.em").attr("class","popup_selection fa-lg fa-circle persontype").attr("transform","translate(-1000,-100)").attr("x",1.7*a).attr("y",1.5*a).text(" ").append("svg:title").text("add female");n.append("text").attr("font-family","FontAwesome").style("opacity",0).attr("font-size","1.em").attr("transform","translate(-1000,-100)").attr("class","popup_selection fa-lg fa-unspecified popup_selection_rotate45 persontype").text(" ").append("svg:title").text("add unspecified"),n.append("text").attr("font-family","FontAwesome").style("opacity",0).attr("transform","translate(-1000,-100)").attr("class","popup_selection fa-2x fa-angle-up persontype dztwin").attr("x",4.6*a).attr("y",1.5*a).text(" ").append("svg:title").text("add dizygotic/fraternal twins"),n.append("text").attr("font-family","FontAwesome").style("opacity",0).attr("transform","translate(-1000,-100)").attr("class","popup_selection fa-2x fa-caret-up persontype mztwin").attr("x",6.2*a).attr("y",1.5*a).text("").append("svg:title").text("add monozygotic/identical twins");var l={};i.selectAll(".persontype").on("click",function(){var t,a,n=E(v(e)),r=i.select(this).classed("mztwin"),o=i.select(this).classed("dztwin");if(r||o?(a=l.node.datum().data.sex,t=r?"mztwin":"dztwin"):a=i.select(this).classed("fa-square")?"M":i.select(this).classed("fa-circle")?"F":"U","addsibling"===l.type)dt(n,l.node.datum().data,a,!1,t);else{if("addchild"!==l.type)return;lt(n,l.node.datum().data,t?"U":a,t?2:1,t)}e.dataset=n,st(e),i.selectAll(".popup_selection").style("opacity",0),l={}}).on("mouseover",function(){l.node&&l.node.select("rect").style("opacity",.2),i.selectAll(".popup_selection").style("opacity",1),"addsibling"===l.type?i.select(this).classed("fa-square")?o.text("add brother"):s.text("add sister"):"addchild"===l.type&&(i.select(this).classed("fa-square")?o.text("add son"):s.text("add daughter"))}),i.selectAll(".popup_selection").on("mouseout",function(){void 0!==l.node&&-1==m.indexOf(l.node.datum())&&l.node.select("rect").style("opacity",0),i.selectAll(".popup_selection").style("opacity",0)}),function(e){i.select(".diagram").append("line").attr("class","line_drag_selection").attr("stroke-width",6).style("stroke-dasharray","2, 1").attr("stroke","black").call(i.drag().on("start",function(){je=He,i.selectAll(".line_drag_selection").attr("stroke","darkred")}).on("drag",function(t){i.event.sourceEvent.stopPropagation();var a=i.event.dx,n=i.event.dy,r=parseFloat(i.select(this).attr("x2"))+a,o=parseFloat(i.select(this).attr("y2"))+n;Je(e.symbol_size-10,0,r,o)}).on("end",function(t){if(He&&je.data.name!==He.data.name&&je.data.sex!==He.data.sex){var a={name:S(4),sex:"U",mother:"F"===je.data.sex?je.data.name:He.data.name,father:"F"===je.data.sex?He.data.name:je.data.name},n=E(e.dataset);e.dataset=n;var r=J(e.dataset,je.data.name)+1;e.dataset.splice(r,0,a),st(e)}Je(0,0,0,0),i.selectAll(".line_drag_selection").attr("stroke","black"),je=void 0})).append("svg:title").text("drag to create consanguineous partners"),Je(0,0,0,0)}(e),t.filter(function(t){return!(t.data.hidden&&!e.DEBUG)}).append("rect").attr("class","indi_rect").attr("rx",6).attr("ry",6).attr("x",function(t){return-.75*e.symbol_size}).attr("y",function(t){return-e.symbol_size}).attr("width",1.5*e.symbol_size+"px").attr("height",2*e.symbol_size+"px").style("stroke","black").style("stroke-width",.7).style("opacity",0).attr("fill","lightgrey");var d=function(t){return u-.75*e.symbol_size},c=e.symbol_size-2,u=0,f={addchild:{text:"",title:"add child",fx:d,fy:c},addsibling:{text:"",title:"add sibling",fx:d,fy:c},addpartner:{text:"",title:"add partner",fx:d,fy:c},addparents:{text:"",title:"add parents",fx:-.75*e.symbol_size,fy:11-e.symbol_size},delete:{text:"X",title:"delete",fx:e.symbol_size/2-1,fy:12-e.symbol_size,styles:{"font-weight":"bold",fill:"darkred","font-family":"monospace"}}};e.edit&&(f.settings={text:"",title:"settings",fx:-a/2+2,fy:11-e.symbol_size});var h=function(a){var n=t.filter(function(t){return!(t.data.hidden&&!e.DEBUG||(void 0===t.data.mother||t.data.noparents)&&"addsibling"===a||void 0!==t.data.parent_node&&t.data.parent_node.length>1&&"addpartner"===a||void 0===t.data.parent_node&&"addchild"===a||void 0===t.data.noparents&&void 0===t.data.top_level&&"addparents"===a)}).append("text").attr("class",a).style("opacity",0).attr("font-family","FontAwesome").attr("xx",function(e){return e.x}).attr("yy",function(e){return e.y}).attr("x",f[a].fx).attr("y",f[a].fy).attr("font-size","0.9em").text(f[a].text);if("styles"in f[a])for(var r in f[a].styles)n.attr(r,f[a].styles[r]);n.append("svg:title").text(f[a].title),u+=17};for(var p in f)h(p);i.selectAll(".addsibling, .addchild").on("mouseover",function(){var e=i.select(this).attr("class");i.selectAll(".popup_selection").style("opacity",1),l={node:i.select(this.parentNode),type:e};var t=parseInt(i.select(this).attr("xx"))+parseInt(i.select(this).attr("x")),n=parseInt(i.select(this).attr("yy"))+parseInt(i.select(this).attr("y"));i.selectAll(".popup_selection").attr("transform","translate("+t+","+(n+2)+")"),i.selectAll(".popup_selection_rotate45").attr("transform","translate("+(t+3*a)+","+(n+1.2*a)+") rotate(45)")}),i.selectAll(".addchild, .addpartner, .addparents, .delete, .settings").on("click",function(){i.event.stopPropagation();var t,a=i.select(this).attr("class"),n=i.select(this.parentNode).datum();e.DEBUG&&console.log(a),"settings"===a?"function"==typeof e.edit?e.edit(e,n):function(e,t){r("#node_properties").dialog({autoOpen:!1,title:t.data.display_name,width:r(window).width()>400?450:r(window).width()-30});var a="<table id='person_details' class='table'>";a+="<tr><td style='text-align:right'>Unique ID</td><td><input class='form-control' type='text' id='id_name' name='name' value="+(t.data.name?t.data.name:"")+"></td></tr>",a+="<tr><td style='text-align:right'>Name</td><td><input class='form-control' type='text' id='id_display_name' name='display_name' value="+(t.data.display_name?t.data.display_name:"")+"></td></tr>",a+="<tr><td style='text-align:right'>Age</td><td><input class='form-control' type='number' id='id_age' min='0' max='120' name='age' style='width:7em' value="+(t.data.age?t.data.age:"")+"></td></tr>",a+="<tr><td style='text-align:right'>Year Of Birth</td><td><input class='form-control' type='number' id='id_yob' min='1900' max='2050' name='yob' style='width:7em' value="+(t.data.yob?t.data.yob:"")+"></td></tr>",a+='<tr><td colspan="2" id="id_sex"><label class="radio-inline"><input type="radio" name="sex" value="M" '+("M"===t.data.sex?"checked":"")+'>Male</label><label class="radio-inline"><input type="radio" name="sex" value="F" '+("F"===t.data.sex?"checked":"")+'>Female</label><label class="radio-inline"><input type="radio" name="sex" value="U">Unknown</label></td></tr>',a+='<tr><td colspan="2" id="id_status"><label class="checkbox-inline"><input type="radio" name="status" value="0" '+(0===parseInt(t.data.status)?"checked":"")+'>&thinsp;Alive</label><label class="checkbox-inline"><input type="radio" name="status" value="1" '+(1===parseInt(t.data.status)?"checked":"")+">&thinsp;Deceased</label></td></tr>",r("#id_status input[value='"+t.data.status+"']").prop("checked",!0);var n=["adopted_in","adopted_out","miscarriage","stillbirth","termination"];a+='<tr><td colspan="2"><strong>Reproduction:</strong></td></tr>',a+='<tr><td colspan="2">';for(var i=0;i<n.length;i++){var o=n[i];2===i&&(a+='</td></tr><tr><td colspan="2">'),a+='<label class="checkbox-inline"><input type="checkbox" id="id_'+o+'" name="'+o+'" value="0" '+(t.data[o]?"checked":"")+">&thinsp;"+Xe(o.replace("_"," "))+"</label>"}a+="</td></tr>";var s=["children","name","parent_node","top_level","id","noparents","level","age","sex","status","display_name","mother","father","yob","mztwin","dztwin"];r.merge(s,n),a+='<tr><td colspan="2"><strong>Age of Diagnosis:</strong></td></tr>',r.each(e.diseases,function(n,r){s.push(r.type+"_diagnosis_age");var i='&thinsp;<span style="padding-left:5px;background:'+e.diseases[n].colour+'"></span>',o=t.data[r.type+"_diagnosis_age"];a+="<tr><td style='text-align:right'>"+Xe(r.type.replace("_"," "))+i+"&nbsp;</td><td><input class='form-control' id='id_"+r.type+"_diagnosis_age_0' max='110' min='0' name='"+r.type+"_diagnosis_age_0' style='width:5em' type='number' value='"+(void 0!==o?o:"")+"'></td></tr>"}),a+='<tr><td colspan="2" style="line-height:1px;"></td></tr>',r.each(t.data,function(e,t){if(-1==r.inArray(e,s)){var n=Xe(e);!0===t||!1===t?a+="<tr><td style='text-align:right'>"+n+"&nbsp;</td><td><input type='checkbox' id='id_"+e+"' name='"+e+"' value="+t+" "+(t?"checked":"")+"></td></tr>":e.length>0&&(a+="<tr><td style='text-align:right'>"+n+"&nbsp;</td><td><input type='text' id='id_"+e+"' name='"+e+"' value="+t+"></td></tr>")}}),a+="</table>",r("#node_properties").html(a),r("#node_properties").dialog("open"),r("#node_properties input[type=radio], #node_properties input[type=checkbox], #node_properties input[type=text], #node_properties input[type=number]").change(function(){Re(e)})}(e,n):"delete"===a?mt(t=E(v(e)),n.data,e,Ye):"addparents"===a?(t=E(v(e)),e.dataset=t,ft(e,t,n.data.name),st(e)):"addpartner"===a&&(t=E(v(e)),ht(e,t,n.data.name),e.dataset=t,st(e)),r(document).trigger("fhChange",[e])});var m=[];t.filter(function(e){return!e.data.hidden}).on("click",function(t){i.event.ctrlKey?-1==m.indexOf(t)?m.push(t):m.splice(m.indexOf(t),1):m=[t],"nodeclick"in e&&(e.nodeclick(t.data),i.selectAll(".indi_rect").style("opacity",0),i.selectAll(".indi_rect").filter(function(e){return-1!=m.indexOf(e)}).style("opacity",.5))}).on("mouseover",function(t){i.event.stopPropagation(),He=t,je?je.data.name!==He.data.name&&je.data.sex!==He.data.sex&&i.select(this).select("rect").style("opacity",.2):(i.select(this).select("rect").style("opacity",.2),i.select(this).selectAll(".addchild, .addsibling, .addpartner, .addparents, .delete, .settings").style("opacity",1),i.select(this).selectAll(".indi_details").style("opacity",0),Je(e.symbol_size-10,0,e.symbol_size-2,0,t.x+","+(t.y+2)))}).on("mouseout",function(t){if(!je){i.select(this).selectAll(".addchild, .addsibling, .addpartner, .addparents, .delete, .settings").style("opacity",0),-1==m.indexOf(t)&&i.select(this).select("rect").style("opacity",0),i.select(this).selectAll(".indi_details").style("opacity",1);var a=i.mouse(this)[0],n=i.mouse(this)[1];n<.8*e.symbol_size&&i.selectAll(".popup_selection").style("opacity",0),je||(Math.abs(n)>.25*e.symbol_size||Math.abs(n)<-.25*e.symbol_size||a<.2*e.symbol_size)&&Je(0,0,0,0)}})}function Ye(e,t){e.dataset=t,st(e)}function Je(e,t,a,n,r){r&&i.selectAll(".line_drag_selection").attr("transform","translate("+r+")"),i.selectAll(".line_drag_selection").attr("x1",e).attr("y1",t).attr("x2",a).attr("y2",n)}function Xe(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Ve(e,t){for(var a="",n=0;n<t.length;n++){var r=t[n];if(e.data[r])if("alleles"===r)for(var i=e.data.alleles.split(";"),o=0;o<i.length;o++)""!==i[o]&&(a+=i[o]+";");else if("age"===r)a+=e.data[r]+"y ";else if("stillbirth"===r)a+="SB";else if(r.match("_gene_test$")&&"result"in e.data[r]){var s=e.data[r].result.toUpperCase();"-"!==s&&(a+=r.replace("_gene_test","").toUpperCase(),a+="P"===s?"+ ":"N"===s?"- ":" ")}else if(r.match("_bc_pathology$")){var l=e.data[r].toUpperCase();a+=r.replace("_bc_pathology","").toUpperCase(),a+="P"===l?"+ ":"N"===l?"- ":" "}else a+=e.data[r]}if(""!==a)return a}function Ke(e,t,a){if(We(e,t))return e.y_offset=e.y_offset?e.y_offset+a:2.35*a,e.y_offset}function We(e,t){for(var a=0;a<t.length;a++)if(F(t[a],e.data))return!0;return!1}function Ze(e,t,a,n,r,i,o){t.filter(function(e){return!e.data.hidden&&(!o||We(e,o))}).append("text").attr("class",i?i+" ped_label":"ped_label").attr("x",a).attr("y",n).attr("font-family",e.font_family).attr("font-size",e.font_size).attr("font-weight",e.font_weight).text(r)}var Qe={};function et(e){var t=r.extend({targetDiv:"pedigree_edit",dataset:[{name:"m21",display_name:"father",sex:"M",top_level:!0},{name:"f21",display_name:"mother",sex:"F",top_level:!0},{name:"ch1",display_name:"me",sex:"F",mother:"f21",father:"m21",proband:!0}],width:600,height:400,symbol_size:35,zoomSrc:["wheel","button"],zoomIn:1,zoomOut:1,diseases:[{type:"breast_cancer",colour:"#F68F35"},{type:"breast_cancer2",colour:"pink"},{type:"ovarian_cancer",colour:"#4DAA4D"},{type:"pancreatic_cancer",colour:"#4289BA"},{type:"prostate_cancer",colour:"#D5494A"}],labels:["stillbirth",["age","yob"],"alleles",["brca1_gene_test","brca2_gene_test","palb2_gene_test","chek2_gene_test","atm_gene_test"],["rad51d_gene_test","rad51c_gene_test","brip1_gene_test"],["er_bc_pathology","pr_bc_pathology","her2_bc_pathology","ck14_bc_pathology","ck56_bc_pathology"]],keep_proband_on_reset:!1,font_size:".75em",font_family:"Helvetica",font_weight:700,background:"#EEE",node_background:"#fdfdfd",validate:!0,DEBUG:!1},e);0===r("#fullscreen").length&&(ce(t),ze(t)),-1==_(t)&&g(t),function(e){var t=p(e),a=_(e),n="#"+e.btn_target;a<=t?r(n+" .fa-repeat").addClass("disabled"):r(n+" .fa-repeat").removeClass("disabled"),t>1?r(n+" .fa-undo").removeClass("disabled"):r(n+" .fa-undo").addClass("disabled")}(t),at(t),t.dataset=function(e){for(var t=0;t<e.length;t++)2==Y(e,e[t].name)&&(e[t].top_level=!0);for(var a=[],n=[],i=0;i<e.length;i++){var o=e[i];if("top_level"in o&&-1==r.inArray(o.name,n)){n.push(o.name),a.push(o);for(var s=L(e,o),l=0;l<s.length;l++)-1==r.inArray(s[l],n)&&(n.push(s[l]),a.push(te(e,s[l])))}}for(var d=r.map(e,function(e,t){return"top_level"in e&&e.top_level?null:e}),c=a.length;c>0;--c)d.unshift(a[c-1]);return d}(t.dataset),t.DEBUG&&ne(t);var a=it(t),n=i.select("#"+t.targetDiv).append("svg:svg").attr("width",a.width).attr("height",a.height);n.append("rect").attr("width","100%").attr("height","100%").attr("rx",6).attr("ry",6).style("stroke","darkgrey").style("fill",t.background).style("stroke-width",1);var o=n.append("g").attr("class","diagram"),s={name:"hidden_root",id:0,hidden:!0,children:r.map(t.dataset,function(e,t){return"top_level"in e&&e.top_level?e:null})},l=D(t,s,s)[0],d=i.hierarchy(s);Qe[t.targetDiv]=d;var c=ot(t);t.DEBUG&&console.log("opts.width="+a.width+" width="+c.width+" opts.height="+a.height+" height="+c.height);var u=i.tree().separation(function(e,t){return e.parent===t.parent||e.data.hidden||t.data.hidden?1.2:2.2}).size([c.width,c.height])(d.sort(function(e,t){return e.data.id-t.data.id})),f=u.descendants();if(r.map(t.dataset,function(e,t){return e.hidden?null:e}).length!=t.dataset.length)throw tt("NUMBER OF VISIBLE NODES DIFFERENT TO NUMBER IN THE DATASET");Q(t,u,f);var h=V(f,l);!function(e,t){for(var a=0;a<t.length;a++){var n=rt(e,t[a]);n&&console.log("CLASH :: "+t[a].mother.data.name+" "+t[a].father.data.name,n)}}(t,h);var m=o.selectAll(".node").data(u.descendants()).enter().append("g").attr("transform",function(e,t){return"translate("+e.x+","+e.y+")"});m.filter(function(e){return!e.data.hidden}).append("path").attr("shape-rendering","geometricPrecision").attr("transform",function(e){return"U"!=e.data.sex||e.data.miscarriage||e.data.termination?"":"rotate(45)"}).attr("d",i.symbol().size(function(e){return t.symbol_size*t.symbol_size+2}).type(function(e){return e.data.miscarriage||e.data.termination?i.symbolTriangle:"F"==e.data.sex?i.symbolCircle:i.symbolSquare})).style("stroke",function(e){return e.data.age&&e.data.yob&&!e.data.exclude?"#303030":"grey"}).style("stroke-width",function(e){return e.data.age&&e.data.yob&&!e.data.exclude?".3em":".1em"}).style("stroke-dasharray",function(e){return e.data.exclude?"3, 3":null}).style("fill","none"),m.filter(function(e){return!(e.data.hidden&&!t.DEBUG)}).append("clipPath").attr("id",function(e){return e.data.name}).append("path").attr("class","node").attr("transform",function(e){return"U"!=e.data.sex||e.data.miscarriage||e.data.termination?"":"rotate(45)"}).attr("d",i.symbol().size(function(e){return e.data.hidden?t.symbol_size*t.symbol_size/5:t.symbol_size*t.symbol_size}).type(function(e){return e.data.miscarriage||e.data.termination?i.symbolTriangle:"F"==e.data.sex?i.symbolCircle:i.symbolSquare})),m.filter(function(e){return!(e.data.hidden&&!t.DEBUG)}).selectAll("pienode").data(function(e){var a=0,n=r.map(t.diseases,function(n,r){return F(t.diseases[r].type,e.data)?(a++,1):0});return 0===a&&(n=[1]),[r.map(n,function(t,n){return{cancer:t,ncancers:a,id:e.data.name,sex:e.data.sex,proband:e.data.proband,hidden:e.data.hidden,affected:e.data.affected,exclude:e.data.exclude}})]}).enter().append("g").selectAll("path").data(i.pie().value(function(e){return e.cancer})).enter().append("path").attr("clip-path",function(e){return"url(#"+e.data.id+")"}).attr("class","pienode").attr("d",i.arc().innerRadius(0).outerRadius(t.symbol_size)).style("fill",function(e,a){return e.data.exclude?"lightgrey":0===e.data.ncancers?e.data.affected?"darkgrey":t.node_background:t.diseases[a].colour}),m.filter(function(e){return!e.data.hidden&&(e.data.adopted_in||e.data.adopted_out)}).append("path").attr("d",function(e){var a=-.66*t.symbol_size,n=-.64*t.symbol_size,r=t.symbol_size/4;return nt(a,n,r,t)+nt(-a,n,-r,t)}).style("stroke",function(e){return e.data.age&&e.data.yob&&!e.data.exclude?"#303030":"grey"}).style("stroke-width",function(e){return".1em"}).style("stroke-dasharray",function(e){return e.data.exclude?"3, 3":null}).style("fill","none"),m.filter(function(e){return 1==e.data.status}).append("line").style("stroke","black").attr("x1",function(e,a){return-.6*t.symbol_size}).attr("y1",function(e,a){return.6*t.symbol_size}).attr("x2",function(e,a){return.6*t.symbol_size}).attr("y2",function(e,a){return-.6*t.symbol_size}),function(e,t){Ze(e,t,-.4*e.symbol_size,-.1*e.symbol_size,function(t){return e.DEBUG?("display_name"in t.data?t.data.display_name:t.data.name)+"  "+t.data.id:"display_name"in t.data?t.data.display_name:""},void 0,["display_name"]);for(var a=parseInt(function(e){var t=e.font_size;return t===parseInt(t,10)?t:t.indexOf("px")>-1?t.replace("px",""):-1===t.indexOf("em")?t:(t=parseFloat(t.replace("em","")),parseFloat(getComputedStyle(r("#"+e.targetDiv).get(0)).fontSize)*t-1)}(e))+4,n=function(n){var r=e.labels[n],i=Array.isArray(r)?r:[r];(i.indexOf("age")>-1||i.indexOf("yob")>-1)&&Ze(e,t,-e.symbol_size,function(e){return Ke(e,i,a)},function(e){return Ve(e,i)},"indi_details",i)},i=0;i<e.labels.length;i++)n(i);for(var o=function(n){var r=e.diseases[n].type;Ze(e,t,-e.symbol_size,function(e){return Ke(e,[r],a)},function(e){var t=r.replace("_"," ").replace("cancer","ca.");return r+"_diagnosis_age"in e.data?t+": "+e.data[r+"_diagnosis_age"]:""},"indi_details",[r])},s=0;s<e.diseases.length;s++)o(s);for(var l=function(n){var r=e.labels[n],i=Array.isArray(r)?r:[r];-1===i.indexOf("age")&&-1===i.indexOf("yob")&&Ze(e,t,-e.symbol_size,function(e){return Ke(e,i,a)},function(e){return Ve(e,i)},"indi_details",i)},d=0;d<e.labels.length;d++)l(d)}(t,m),qe(t,m);var v={},y=function(e,t,a,n,r,i){for(var o=function e(t,a){return t+1<a?e(++t):t},s="",l=0;l<e.length;l++){var d=o(l,e.length),c=e[l]-t-i,u=e[d]+t+i;r.x>c&&r.x<u&&(r.y=n),s+="L"+c+","+(a-i)+"L"+c+","+(n-i)+"L"+u+","+(n-i)+"L"+u+","+(a-i),l=d}return s};l=o.selectAll(".partner").data(h).enter().insert("path","g").attr("fill","none").attr("stroke","#000").attr("shape-rendering","auto").attr("d",function(e,a){var n,r,i,o=W(te(f,e.mother.data.name),te(f,e.father.data.name),t),s=e.mother.data.divorced&&e.mother.data.divorced===e.father.data.name,l=e.mother.x<e.father.x?e.mother.x:e.father.x,d=e.mother.x<e.father.x?e.father.x:e.mother.x,c=e.mother.y,u=rt(t,e),h="";if(u){e.mother.depth in v?v[e.mother.depth]+=4:v[e.mother.depth]=4,c-=v[e.mother.depth],r=v[e.mother.depth]+t.symbol_size/2+2;for(var p=e.mother.data.parent_node,m=p[0],g=0;g<p.length;g++)p[g].father.name===e.father.data.name&&p[g].mother.name===e.mother.data.name&&(m=p[g].name);(i=te(f,m)).y=c,u.sort(function(e,t){return e-t}),n=c-t.symbol_size/2-3,h=y(u,r,c,n,i,0)}var _="";return s&&!u&&(_="M"+(l+.66*(d-l)+6)+","+(c-6)+"L"+(l+.66*(d-l)-6)+","+(c+6)+"M"+(l+.66*(d-l)+10)+","+(c-6)+"L"+(l+.66*(d-l)-2)+","+(c+6)),o?(c=e.mother.x<e.father.x?e.mother.y:e.father.y,n=e.mother.x<e.father.x?e.father.y:e.mother.y,Math.abs(c-n)>.1?"M"+l+","+c+"L"+d+","+n+"M"+l+","+(c-3)+"L"+d+","+(n-3):"M"+l+","+c+h+"L"+d+","+c+"M"+l+","+(c-3)+(u?y(u,r,c,n,i,3):"")+"L"+d+","+(c-3)+_):"M"+l+","+c+h+"L"+d+","+c+_}),o.selectAll(".link").data(d.links(u.descendants())).enter().filter(function(e){return t.DEBUG||void 0===e.target.data.noparents&&null!==e.source.parent&&!e.target.data.hidden}).insert("path","g").attr("fill","none").attr("stroke-width",function(e,a){return void 0!==e.target.data.noparents||null===e.source.parent||e.target.data.hidden?1:t.DEBUG?2:1}).attr("stroke",function(e,t){return void 0!==e.target.data.noparents||null===e.source.parent||e.target.data.hidden?"pink":"#000"}).attr("stroke-dasharray",function(e,a){if(!e.target.data.adopted_in)return null;var n=Math.abs(e.source.y-(e.source.y+e.target.y)/2),i=[n,0,Math.abs(e.source.x-e.target.x),0];H(t.dataset,e.target.data).length>=1&&(n*=3);for(var o=0;o<n;o+=10)r.merge(i,[5,5]);return i}).attr("shape-rendering",function(e,t){return e.target.data.mztwin||e.target.data.dztwin?"geometricPrecision":"auto"}).attr("d",function(e,a){if(e.target.data.mztwin||e.target.data.dztwin){var n=H(t.dataset,e.target.data);if(n.length>=1){var r=0,i=e.target.x;e.target.x;for(var o=0;o<n.length;o++){var s=te(f,n[o].name).x;i>s&&(i=s),r+=s}var l=(e.target.x+r)/(n.length+1),d=(e.source.y+e.target.y)/2,c="";if(i===e.target.x&&e.target.data.mztwin){var u=(l+e.target.x)/2,h=(d+(e.target.y-t.symbol_size/2))/2;c="M"+u+","+h+"L"+(l+(l-u))+" "+h}return"M"+e.source.x+","+e.source.y+"V"+d+"H"+l+"L"+e.target.x+" "+(e.target.y-t.symbol_size/2)+c}}if(e.source.data.mother){var p=te(f,e.source.data.mother.name),m=te(f,e.source.data.father.name);if(p.depth!==m.depth)return"M"+e.source.x+","+(p.y+m.y)/2+"H"+e.target.x+"V"+e.target.y}return"M"+e.source.x+","+e.source.y+"V"+(e.source.y+e.target.y)/2+"H"+e.target.x+"V"+e.target.y});var x=B(t.dataset);if(void 0!==x){var b=te(f,t.dataset[x].name),w="triangle"+S(3);o.append("svg:defs").append("svg:marker").attr("id",w).attr("refX",6).attr("refY",6).attr("markerWidth",20).attr("markerHeight",20).attr("orient","auto").append("path").attr("d","M 0 0 12 6 0 12 3 6").style("fill","black"),o.append("line").attr("x1",b.x-t.symbol_size/.7).attr("y1",b.y+t.symbol_size/1.4).attr("x2",b.x-t.symbol_size/1.4).attr("y2",b.y+t.symbol_size/4).attr("stroke-width",1).attr("stroke","black").attr("marker-end","url(#"+w+")")}return oe(t,n),t}function tt(e){return console.error(e),new Error(e)}function at(e){if(e.validate){if("function"==typeof e.validate)return e.DEBUG&&console.log("CALLING CONFIGURED VALIDATION FUNCTION"),e.validate.call(this,e);for(var t,a=[],n=[],i=0;i<e.dataset.length;i++){if(!i.hidden&&(e.dataset[i].mother||e.dataset[i].father)){(t=e.dataset[i].display_name)||(t="unnamed"),t+=" (IndivID: "+e.dataset[i].name+")";var o=e.dataset[i].mother,s=e.dataset[i].father;if(!o||!s)throw tt("Missing parent for "+t);var l=J(e.dataset,o),d=J(e.dataset,s);if(-1===l)throw tt("The mother (IndivID: "+o+") of family member "+t+" is missing from the pedigree.");if(-1===d)throw tt("The father (IndivID: "+s+") of family member "+t+" is missing from the pedigree.");if("F"!==e.dataset[l].sex)throw tt("The mother of family member "+t+" is not specified as female. All mothers in the pedigree must have sex specified as 'F'.");if("M"!==e.dataset[d].sex)throw tt("The father of family member "+t+" is not specified as male. All fathers in the pedigree must have sex specified as 'M'.")}if(!e.dataset[i].name)throw tt(t+" has no IndivID.");if(r.inArray(e.dataset[i].name,a)>-1)throw tt("IndivID for family member "+t+" is not unique.");a.push(e.dataset[i].name),-1===r.inArray(e.dataset[i].famid,n)&&e.dataset[i].famid&&n.push(e.dataset[i].famid)}if(n.length>1)throw tt("More than one family found: "+n.join(", ")+".");var c=R(e.dataset);c.length>0&&console.warn("individuals unconnected to pedigree ",c)}}function nt(e,t,a,n){return"M"+(e+a)+","+t+"L"+e+" "+t+"L"+e+" "+(t+1.28*n.symbol_size)+"L"+e+" "+(t+1.28*n.symbol_size)+"L"+(e+a)+","+(t+1.28*n.symbol_size)}function rt(e,t){var a,n,i=Z(Qe[e.targetDiv]);if("name"in t){if(!("mother"in(t=te(i,t.name)).data))return null;a=te(i,t.data.mother),n=te(i,t.data.father)}else a=t.mother,n=t.father;var o=a.x<n.x?a.x:n.x,s=a.x<n.x?n.x:a.x,l=a.y,d=r.map(i,function(e,t){return!e.data.hidden&&e.data.name!==a.data.name&&e.data.name!==n.data.name&&e.y==l&&e.x>o&&e.x<s?e.x:null});return d.length>0?d:null}function it(e){return{width:ue()?window.innerWidth:e.width,height:ue()?window.innerHeight:e.height}}function ot(e){for(var t=it(e),a=0,n={},r=0;r<e.dataset.length;r++){var i=Y(e.dataset,e.dataset[r].name),o=q(e.dataset,e.dataset[r]),s=1+(o.length>0?.55+.25*o.length:0)+(e.dataset[r].father?.25:0);i in n?n[i]+=s:n[i]=s,n[i]>a&&(a=n[i])}var l=Object.keys(n).length*e.symbol_size*3.5;return{width:t.width-e.symbol_size>a*e.symbol_size*1.65?t.width-e.symbol_size:a*e.symbol_size*1.65,height:t.height-e.symbol_size>l?t.height-e.symbol_size:l}}function st(e){r("#"+e.targetDiv).empty(),g(e);try{et(e)}catch(e){throw console.error(e),e}try{templates.update(e)}catch(e){}}function lt(e,a,n,i,o){if(o&&-1===r.inArray(o,["mztwin","dztwin"]))return new Error("INVALID TWIN TYPE SET: "+o);"undefined"===t(i)&&(i=1);var s,l,d,c=q(e,a);if(0===c.length){var u=dt(e,a,"F"===a.sex?"M":"F","F"===a.sex);u.noparents=!0,s=u.name,l=J(e,a.name)+1}else{var f=c[0];s=f.father===a.name?f.mother:f.father,l=J(e,f.name)}o&&(d=ct(e,o));for(var h=[],p=0;p<i;p++){var m={name:S(4),sex:n,mother:"F"===a.sex?a.name:s,father:"F"===a.sex?s:a.name};e.splice(l,0,m),o&&(m[o]=d),h.push(m)}return h}function dt(e,t,a,n,i){if(i&&-1===r.inArray(i,["mztwin","dztwin"]))return new Error("INVALID TWIN TYPE SET: "+i);var o={name:S(4),sex:a};t.top_level?o.top_level=!0:(o.mother=t.mother,o.father=t.father);var s=J(e,t.name);return i&&function(e,t,a,n){if(!t[n]&&(t[n]=ct(e,n),!t[n]))return!1;a[n]=t[n],t.yob&&(a.yob=t.yob),!t.age||0!=t.status&&t.status||(a.age=t.age)}(e,e[s],o,i),n?s>0&&s--:s++,e.splice(s,0,o),o}function ct(e,t){for(var a=[1,2,3,4,5,6,7,8,9,"A"],n=0;n<e.length;n++)if(e[n][t]){var r=a.indexOf(e[n][t]);r>-1&&a.splice(r,1)}if(a.length>0)return a[0]}function ut(e,t){if(t.mztwin||t.dztwin)for(var a=t.mztwin?"mztwin":"dztwin",n=0;n<e.length;n++){var r=e[n];r[a]&&t[a]==r[a]&&r.name!==t.name&&("mztwin"===a&&(r.sex=t.sex),t.yob&&(r.yob=t.yob),!t.age||0!=t.status&&t.status||(r.age=t.age))}}function ft(e,t,a){var n,r,i,o,s=Z(Qe[e.targetDiv]),l=te(s,a),d=l.data,c=l.depth,u=-101,f=q(t,d);if(f.length>0&&(u=te(s,i=f[0].mother==d.name?f[0].father:f[0].mother).data.id),1==c)for(n={name:S(4),sex:"F",top_level:!0},r={name:S(4),sex:"M",top_level:!0},t.splice(0,0,n),t.splice(0,0,r),o=0;o<t.length;o++)t[o].top_level&&t[o].name!==n.name&&t[o].name!==r.name&&(delete t[o].top_level,t[o].noparents=!0,t[o].mother=n.name,t[o].father=r.name);else{var h=te(s,l.data.mother),p=te(s,l.data.father),m=j(t,d),g=1e4,_=l.data.id;for(o=0;o<m.length;o++){var v=te(s,m[o].name).data.id;v<g&&v>l.data.id&&(g=v),v<_&&(_=v)}var y=_>=l.data.id||u==_&&g<1e4;e.DEBUG&&console.log("lid="+_+" rid="+g+" nid="+l.data.id+" ADD_LHS="+y);var x=t[!y&&p.data.id>h.data.id||y&&p.data.id<h.data.id?J(t,d.father):J(t,d.mother)];r=dt(t,x,"M",y),n=dt(t,x,"F",y);var b=J(t,r.name),w=J(t,n.name);if(b>w){var z=t[b];t[b]=t[w],t[w]=z}var k=$(t,d),A=l.data.id;for(o=0;o<k.length;o++){var O=te(s,k[o].name).data.id;if(e.DEBUG&&console.log("ORPHAN="+o+" "+k[o].name+" "+(A<O&&O<g)+" nid="+A+" oid="+O+" rid="+g),(y||A<O)&&O<g){var E=J(t,k[o].name);t[E].mother=n.name,t[E].father=r.name}}}2==c?(n.top_level=!0,r.top_level=!0):c>2&&(n.noparents=!0,r.noparents=!0);var F=J(t,d.name);if(t[F].mother=n.name,t[F].father=r.name,delete t[F].noparents,"parent_node"in d){var I=t[J(t,i)];"noparents"in I&&(I.mother=n.name,I.father=r.name)}}function ht(e,t,a){var n=te(Z(Qe[e.targetDiv]),a),r=dt(t,n.data,"F"===n.data.sex?"M":"F","F"===n.data.sex);r.noparents=!0;var i={name:S(4),sex:"M"};i.mother="F"===n.data.sex?n.data.name:r.name,i.father="F"===n.data.sex?r.name:n.data.name;var o=J(t,n.data.name)+2;t.splice(o,0,i)}function pt(e,t,a){for(var n,r,i=X(Z(e),t.depth,a),o=0;o<i.length;o++)i[o].x<t.x&&(n=i[o]),!r&&i[o].x>t.x&&(r=i[o]);return[n,r]}function mt(e,t,a,n){var i,o,s,l=Qe[a.targetDiv],d=Z(l),c=[];if(void 0===t.id){var u=te(d,t.name);void 0!==u&&(t=u.data)}if(t.parent_node)for(i=0;i<t.parent_node.length;i++){var f=t.parent_node[i],h=[te(e,f.mother.name),te(e,f.father.name)];for(o=0;o<h.length;o++)(h[o].name===t.name||void 0!==h[o].noparents||h[o].top_level)&&(e.splice(J(e,h[o].name),1),c.push(h[o]));var p=f.children,m=r.map(p,function(e,t){return e.name});for(o=0;o<p.length;o++){var g=te(e,p[o].name);if(g){g.noparents=!0;var _=L(e,g),v=void 0;if(_.length>0&&(v=te(e,_[0])),v&&v.mother!==g.mother)g.mother=v.mother,g.father=v.father;else if(v){var y=pt(l,te(d,g.name),m);g.mother=y[0]?y[0].data.mother:y[1]?y[1].data.mother:null,g.father=y[0]?y[0].data.father:y[1]?y[1].data.father:null}else e.splice(J(e,g.name),1)}}}else e.splice(J(e,t.name),1);for(console.log(c),i=0;i<c.length;i++){var x=c[i],b=j(e,x);if(console.log("DEL",x.name,b),b.length<1){console.log("del sibs",x.name,b);var w=te(d,x.name).ancestors();for(o=0;o<w.length;o++)console.log(w[i]),w[o].data.mother&&(console.log("DELETE ",w[o].data.mother,w[o].data.father),e.splice(J(e,w[o].data.mother.name),1),e.splice(J(e,w[o].data.father.name),1))}}!function(e){for(var t=["mztwin","dztwin"],a=0;a<e.length;a++)for(var n=0;n<t.length;n++){var r=t[n];if(e[a][r]){for(var i=0,o=0;o<e.length;o++)e[o][r]==e[a][r]&&i++;i<2&&delete e[a][[r]]}}}(e);try{var z=r.extend({},a);z.dataset=E(e),at(z),s=R(e)}catch(e){throw I("Warning","Deletion of this pedigree member is disallowed."),e}return s.length>0&&0===R(a.dataset).length?(console.error("individuals unconnected to pedigree ",s),void I("Warning","Deleting this will split the pedigree. Continue?",n,a,e)):(n&&n(a,e),e)}var gt=Object.freeze({__proto__:null,roots:Qe,build:et,validate_pedigree:at,check_ptr_link_clashes:rt,get_tree_dimensions:ot,rebuild:st,addchild:lt,addsibling:dt,syncTwins:ut,addparents:ft,addpartner:ht,delete_node_dataset:mt});e.canrisk_file=we,e.io=Te,e.pedcache=k,e.pedigree_form=$e,e.pedigree_utils=ie,e.pedigreejs=gt,Object.defineProperty(e,"__esModule",{value:!0})}({});let o=globalThis.pedigreejs;(0,n.$)(document).ready(function(){var e=(0,n.$)("#pedigrees").parent().width(),t=(0,n.$)(window).width()-e>10?100:30,a=e>750?9*e/12-t:e-t,r=o.io.readLinkage("fam1 1 6 7 2 2 0 1 0 0\nfam1 2 4 5 1 1 0 0 0 0\nfam1 3 2 1 2 1 0 0 0 1\nfam1 4 0 0 1 1 0 0 0 0\nfam1 5 0 0 2 2 0 0 0 1\nfam1 6 0 0 1 1 0 0 0 0\nfam1 7 0 0 2 2 0 1 0 1"),i={targetDiv:"pedigrees",btn_target:"history_ex4",width:a,height:400,symbol_size:35,edit:!0,diseases:[{type:"diabetes",colour:"#F68F35"}],labels:["famid","id","alleles"],DEBUG:null!==o.pedigree_utils.urlParam("debug")};(0,n.$)("#opts").append(JSON.stringify(i,null,4));var s=o.pedcache.current(i);i.dataset=null!=s?s:r,i=o.pedigreejs.build(i),(0,n.$)("#history_ex4").css("max-width",a),(0,n.$)("#history_ex4").css("margin","auto"),(0,n.$)("#pedInput").on("change",function(e){console.log("Changing!"),console.log((0,n.$)(this).val());var t=(0,n.$)(this).val();i.dataset=o.io.readLinkage(t),o.pedigreejs.rebuild(i)}),console.log(i)})}};import e from"./chart.js";import*as t from"./pedigree.js";e.C(t),e(e.s=3120);