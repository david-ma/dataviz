"use strict";(self.webpackChunkdataviz=self.webpackChunkdataviz||[]).push([[4],{5438:(t,e,a)=>{var l=a(4345),r=a(7569);console.log("hey, preflight.ts"),l.d3.json("/AGRF/preflight/phases.json").then((t=>{console.log(t),l.d3.select("#buttons").selectAll("button").data(Object.keys(t)).enter().append("button").text((t=>t)).on("click",((e,a)=>{l.d3.select("#phaseTable").html(`<h3>${a}</h3><table></table>`);var r=t[a],i=(0,l.ss)(r.map((t=>({file:t}))),{element:"#phaseTable table",paging:!0,pageLength:100,order:[[7,"desc"]],columns:[{data:"file",title:"Summary File",render:(t,e,l,r)=>{if("display"===e){var i=`<a href="#info" onclick="d3.json('/AGRF/preflight/preflight_${a}/oct/${t}').then(drawDashboard)">${t}</a>`;return l.postflight&&(i+=`<br>\n                    <a href="https://ap-southeast-2.console.aws.amazon.com/s3/buckets/agrf-prod-ngs-archive-analysis-c7c686d?region=ap-southeast-2&bucketType=general&prefix=${l.postflight.prefix}/&showversions=false" target="_blank">AWS S3 Folder</a>`),i}return t}},{data:"included",title:"Included Files",render:(t,e,a,l)=>"sort"===e?a.summary.include.file_count:"display"===e&&a.summary?`${a.summary.include.file_count} files<br>${a.summary.include.file_size_human}`:t},{data:"excluded",title:"Excluded Files",render:(t,e,a,l)=>"sort"===e?a.summary.exclude.file_count:"display"===e&&a.summary?`${a.summary.exclude.file_count} files<br>${a.summary.exclude.file_size_human}`:t},{data:"total",title:"Total Files",render:(t,e,a,l)=>"sort"===e?a.summary.total.file_count:"display"===e&&a.summary?`${a.summary.total.file_count} files<br>${a.summary.total.file_size_human}`:t},{data:"warnings",title:"Warnings",render:(t,e,a,l)=>"sort"===e?a.summary.warnings.length:"display"===e&&a.summary?a.summary.warnings.join("<br>"):t},{data:"file",title:"Postflight",render:(t,e,l,r)=>{if("display"===e){var[i]=t.split(".");return`<a href="#info" onclick="d3.json('/AGRF/preflight/preflight_${a}/postflight/${i}_aws.json').then(drawDashboard)">${i}_aws.json</a>`}return t}},{data:"postflight",title:"Postflight Summary",render:(t,e,a,l)=>"sort"===e?a.postflight.summary.include.object_count:"display"===e&&a.postflight?`${a.postflight.summary.include.object_count} files<br>${a.postflight.summary.include.file_size_human}`:t},{data:"differences",title:"Differences",render:(t,e,a,l)=>{var r=0;return a.summary&&(r=a.summary.include.file_count-a.postflight.summary.include.object_count),"sort"===e?Math.abs(r):"display"===e?r>0?`+${r} files`:r<0?`${r} files`:"No differences":t}},{data:"postflight",title:"Postflight Errors",render:(t,e,a,l)=>"sort"===e?a.postflight.errors.length:"display"===e&&a.postflight?a.postflight.errors.join("<br>"):t}]});Promise.all([Promise.all(r.map((t=>l.d3.json(`/AGRF/preflight/preflight_${a}/oct/${t}`)))),Promise.all(r.map((t=>l.d3.json(`/AGRF/preflight/preflight_${a}/postflight/${t.split(".")[0]}_aws.json`).catch((e=>({summary:{include:{object_count:0,file_size_human:"0 bytes"}},error:t}))))))]).then((([t,e])=>{console.log("Preflight data",t),console.log("Postflight data",e),t.map(((t,a)=>({Files:t.contract_dir,postflight:e[a]}))),t.forEach(((t,a)=>{i.row(a).data({...t,file:r[a],postflight:e[a]})})),i.draw()}))})),r("#buttons button").first().click()})),globalThis.drawDashboard=function(t){l.d3.select("#preview").html(`<h3>Preview</h3><pre>${JSON.stringify(t,null,2)}</pre>`);var e=l.d3.select("#dashboard").html(""),a=e.append("div").attr("id","summary");a.append("h1").text("Summary");var r=a.append("table");r.append("thead").append("tr").selectAll("th").data(["","Size","File Count","Hidden Files","Symlinks"]).enter().append("th").text((t=>t)),r.append("tbody").selectAll("tr").data(Object.entries(t.summary)).enter().append("tr").html((([t,e])=>Array.isArray(e)?`\n          <td colspan="5">${e.join(" ")}</td>\n        `:`\n        <td style="text-transform:capitalize">${t}</td>\n        <td>${e.file_size_human}</td>\n        <td>${e.file_count}</td>\n        <td>${e.hidden_count}</td>\n        <td>${e.symlink_count}</td>\n      `)),function(t,e){var a=e.contract_dir.split("/").pop();console.log("Contract: ",a);var r=e.list.include.files.map((t=>{var e=t[1],l=t[0],r=(e="."===e?a:a+"/"+e)+"/"+l,i=l.split(".").pop();return{name,directory:e,path:r,filesize:t[2],date_modified:t[3],agrf_data_type:t[4],agrf_data_level:t[5],filetype:i}}));t.append("div").attr("id","treemap");const s=l.d3.stratify().path((t=>t.path))(r);s.sum((t=>t&&t.filesize||0)),new l.t1({element:"treemap",margin:5,width:500,height:1e3,nav:!1}).initTreemap({hierarchy:s,target:"filesize",color:i})}(e.append("div").attr("id","dataviz").html("<h1>Data Viz</h1>"),t)};const i=l.d3.scaleOrdinal(["#FFFFFF","#0100F5","#FE0000","#F8D400","#D3D3D3","#000"])}},t=>{t(t.s=5438)}]);