"use strict";(self.webpackChunkdataviz=self.webpackChunkdataviz||[]).push([[448],{8432:(t,e,n)=>{var a=n(706);console.log("Running wealth.ts");let r=null;const o={children:[],wealth:0,name:"World"};let l,i=1;const c={};function s(t){return t.replace(/[ \(\)\.\']/gi,"-")}console.log("Calling csv stuff"),a.d3.csv("/blogposts/WorldWealth.csv",(function(t){if(t.wealth_b||(t.wealth_b="0"),t.region){const e={rank:i++,name:t.country,region:t.region,wealth:parseInt(t.wealth_b)};return c[t.region]=c[t.region]||{name:t.region,wealth:0,children:[],countries:[]},c[t.region].wealth+=e.wealth,c[t.region].countries.push(e),e}return null})).then((function(t){r=t,globalThis.data=t,o.children=Object.keys(c).map((t=>c[t])).sort(((t,e)=>e.wealth-t.wealth)),console.log(Object.keys(c)),l=a.d3.scaleOrdinal().domain(Object.keys(c)).range(["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"]);const e={element:"#dataset table",paging:!0,search:!0,searching:!0,language:{searchPlaceholder:"Search",sLengthMenu:"Show _MENU_"},oLanguage:{sSearch:""},pageLength:10,order:[3,"desc"],columns:[{data:"rank",title:"Rank"},{data:"name",title:"Country"},{data:"region",title:"Region"},{data:"wealth",title:"Wealth (Billions USD)",render:function(t){return a.d3.format("$,")(t)}}],rowCallback:function(t,e){a.d3.select(t).attr("id",`row-${s(e.name)}`).style("background",l(e.region)).on("mouseenter",(function(){a.d3.select(`#${s(e.name)}`).classed("highlight",!0)})).on("mouseout",(function(){a.d3.select(`#${s(e.name)}`).classed("highlight",!1)}))}},n=(0,a.ss)(r,e);globalThis.datatable=n,function(t,e){new a.t1({element:"chart",data:o,width:1e3,height:700,nav:!1,title:"World Wealth 2019, Billions of $USD"}).scratchpad((function(t){globalThis.c=t;const n=t.plot,r=t.innerWidth,i=t.innerHeight;console.log("treemapData",o);const c=a.d3.hierarchy(o).sum((t=>t.wealth));console.log("root",c);const d=a.d3.treemap().size([r,i]).padding(2)(c);console.log(Math.max(...o.children.map((t=>t.wealth))));const u=a.d3.scaleLinear().domain([10,Math.max(...o.children.map((t=>t.wealth)))]).range([.5,1]);globalThis.tree=d,n.selectAll("rect.region").data(d.leaves()).enter().append("rect").classed("region",!0).attr("x",(function(t){return t.x0})).attr("y",(function(t){return t.y0})).attr("width",(function(t){return t.x1-t.x0})).attr("height",(function(t){return t.y1-t.y0})).style("stroke","black").style("fill",(function(t){return l(t.data.name)})).style("opacity",(function(t){return t.parent?u.domain([10,t.parent.total])(t.data.value):1})).each((function(t){console.log(t);const o=t.x1-t.x0,c=t.y1-t.y0,d=a.d3.hierarchy({name:t.data.name,children:t.data.countries,wealth:0}).sum((t=>t.wealth)),h=a.d3.treemap().size([o,c]).padding(2)(d),f=`translate(${t.x0},${t.y0})`,g=n.append("g").attr("id",`${s(t.data.name)}`).attr("transform",f);g.selectAll("rect.country").data(h.leaves()).enter().append("rect").classed("country",!0).attr("id",(t=>s(t.data.name))).attr("x",(function(t){return t.x0})).attr("y",(function(t){return t.y0})).attr("width",(function(t){return t.x1-t.x0})).attr("height",(function(t){return t.y1-t.y0})).style("stroke","black").style("fill",l(t.data.name)).style("opacity",(function(t){return t.parent?u.domain([10,t.parent.total])(t.data.value):1})).on("mouseover",(function(t){a.d3.select(`#row-${s(t.data.name)}`).classed("highlight",!0)})).on("mouseout",(function(t){a.d3.select(`#row-${s(t.data.name)}`).classed("highlight",!1)})).on("click",(function(t){console.log("Zoom in!"),(0,a.$)(".plot").append((0,a.$)(`#${s(t.data.region)}`).detach()),e.search(t.data.region).draw();const l=a.d3.treemap().size([r,i]).padding(2)(d),u=1e3;let h=!1;g.transition().duration(u).attr("transform","translate(0,0)"),g.selectAll("rect.country").data(l.leaves()).transition().duration(u).attr("x",(function(t){return t.x0})).attr("y",(function(t){return t.y0})).attr("width",(function(t){return t.x1-t.x0})).attr("height",(function(t){return t.y1-t.y0})).on("end",(function(){h||(h=!0,console.log("Finished zooming in"),g.selectAll("text").data(l.leaves()).enter().append("text").classed("tempText",!0).attr("x",(function(t){return t.x0+5})).attr("y",(function(t){return t.y0+20})).text((function(t){return t.data.name})).attr("font-size","19px").attr("font-weight","700").attr("fill","black").each((function(t){const e=t.x1-t.x0,n=a.d3.select(this).node();null!=n&&e<n.getBBox().width&&a.d3.select(this).remove()})),g.selectAll(".countryVals").data(l.leaves()).enter().append("text").classed("tempText",!0).attr("x",(function(t){return t.x0+5})).attr("y",(function(t){return t.y0+35})).text((function(t){return`${a.d3.format("$,")(t.data.wealth)} billion`})).attr("font-size","11px").attr("fill","black").each((function(t){const e=t.x1-t.x0,n=a.d3.select(this).node();null!=n&&e<n.getBBox().width&&a.d3.select(this).remove()})),n.append("rect").attr("id","blocker").attr("x",0).attr("y",0).attr("width",r).attr("height",i).attr("fill","rgba(0,0,0,0)").on("click",(function(){console.log("Reverse time!!!"),a.d3.selectAll(".tempText").remove(),e.search("").draw();const t=a.d3.treemap().size([o,c]).padding(2)(d);g.transition().duration(u).attr("transform",f),g.selectAll("rect.country").data(t.leaves()).transition().duration(u).attr("x",(function(t){return t.x0})).attr("y",(function(t){return t.y0})).attr("width",(function(t){return t.x1-t.x0})).attr("height",(function(t){return t.y1-t.y0})),a.d3.select("#blocker").remove()})))}))}))})).on("click",(function(t){console.log(t),e.search(t.data.name).draw()})),n.selectAll("text").data(c.leaves()).enter().append("text").attr("x",(function(t){return t.x0+5})).attr("y",(function(t){return t.y0+20})).text((function(t){return t.data.name})).attr("font-size","19px").attr("font-weight","700").attr("fill","black"),n.selectAll("vals").data(c.leaves()).enter().append("text").attr("x",(function(t){return t.x0+5})).attr("y",(function(t){return t.y0+35})).text((function(t){return`${a.d3.format("$,")(t.data.wealth)} billion`})).attr("font-size","11px").attr("fill","black")}))}(0,n)}))}},t=>{t(t.s=8432)}]);