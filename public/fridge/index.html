<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Fridge Magnets</title>
  </head>

  <body>
    <div id="page" class="row">
      <div class="week" id="top"></div>
      <div class="middle">
        <div class="directions" id="left">
          <div>
            <h1 style="margin-top: 15mm">Buy more</h1>
            <img class="qr" src="qr.png" />
          </div>
          <div>
            <h1>Fresh</h1>
            <h2>←</h2>
          </div>
          <div style="position: absolute">
            <h1>Eat ASAP</h1>
          </div>
        </div>
        <div id="az_box"></div>
        <div id="ruby_box"></div>
        <div class="directions" id="right">
          <div>
            <h1 style="margin-top: 15mm">Buy more</h1>
            <img class="qr" src="qr.png" />
          </div>
          <div>
            <h1>Fresh</h1>
            <h2>←</h2>
          </div>
          <div style="position: absolute">
            <h1>Eat ASAP</h1>
          </div>
        </div>
      </div>
      <div class="week" id="bottom"></div>
    </div>

    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/d3-selection-multi.v1.min.js"></script>

    <link rel="stylesheet" href="/fridge/fridge.css" />

    <script>
      d3.json('/fridge_images').then((images) => {
        const az_images = images.filter((image) => image.includes('az'))
        const ruby_images = images.filter((image) => image.includes('ruby'))

        var az_box = d3.select('#az_box').selectAll('div')

        var boxes = az_box
          .data(az_images)
          .enter()
          .append('div')
          .classed('magnet', true)

        boxes.each((d, i, all) => {
          var magnet = d3.select(all[i])

          magnet.append('img').attrs((image) => {
            return {
              src: `${image}`,
            }
          })
          magnet
            .append('p')
            .html(d.split('.')[0].split('/')[1].replace(/\d/, '').replace('_', '&nbsp;'))
        })

        
        var ruby_box = d3.select('#ruby_box').selectAll('div')

        var boxes = ruby_box
          .data(ruby_images)
          .enter()
          .append('div')
          .classed('magnet', true)

        boxes.each((d, i, all) => {
          var magnet = d3.select(all[i])

          magnet.append('img').attrs((image) => {
            return {
              src: `${image}`,
            }
          })
          magnet
            .append('p')
            .html(d.split('.')[0].split('/')[1].replace(/\d/, '').replace('_', '&nbsp;'))
        })
      })

      const weekdays = [
        'Monday',
        'Tuesday',
        'Wednesday',
        'Thursday',
        'Friday',
        'Saturday',
        'Sunday',
      ]

      d3.select('#top.week')
        .selectAll('.weekday')
        .data(weekdays)
        .enter()
        .append('div')
        .classed('weekday', true)
        .append('p')
        .text((d) => d)

      d3.select('#bottom.week')
        .selectAll('.weekday')
        .data(weekdays)
        .enter()
        .append('div')
        .classed('weekday', true)
        .append('p')
        .text((d) => d)
    </script>
  </body>
</html>
