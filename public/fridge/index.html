<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Fridge Magnets</title>
  </head>

  <body>
    <div id="page" class="row">
      <div id="az" class="set">
        <div class="legends"></div>
        <div class="magnets"></div>
      </div>
      <div id="ruby" class="set">
        <div class="legends"></div>
        <div class="magnets"></div>
      </div>
      <div id="renee" class="set">
        <div class="legends"></div>
        <div class="magnets"></div>
      </div>
    </div>

    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/d3-selection-multi.v1.min.js"></script>

    <link rel="stylesheet" href="/fridge/fridge.css" />

    <script>
      // Draw legend
      drawLegends(d3.select('#az .legends'))
      drawLegends(d3.select('#ruby .legends'))
      drawLegends(d3.select('#renee .legends'))

      function drawLegends(div) {
        div.append('div').classed('legend', true).append('p').text('Buy more')
        div.append('div').classed('legend', true).append('p').text('Fresh')
        div.append('div').classed('legend', true).append('p').text('Eat Soon')
        div.append('div').classed('legend', true).append('p').text('â†’')
      }

      function drawMagnets(div, images) {
        var boxes = div
          .data(images)
          .enter()
          .append('div')
          .classed('magnet', true)

        boxes.each((d, i, all) => {
          var magnet = d3.select(all[i])

          magnet.append('img').attrs((image) => {
            return {
              src: `${image}`,
            }
          })
          magnet
            .append('p')
            .html(
              d
                .split('.')[0]
                .split('/')[1]
                .replace(/\d/, '')
                .replace('_', '&nbsp;')
            )
        })
      }

      d3.json('/fridge_images').then((images) => {
        const az_images = images.filter((image) => image.includes('az'))
        const ruby_images = images.filter((image) => image.includes('ruby'))
        const renee_images = images.filter((image) => image.includes('renee'))

        var az_box = d3.select('div#az div.magnets').selectAll('div')
        drawMagnets(az_box, az_images)

        var ruby_box = d3.select('div#ruby div.magnets').selectAll('div')
        drawMagnets(ruby_box, ruby_images)

        var renee_box = d3.select('div#renee div.magnets').selectAll('div')
        drawMagnets(renee_box, renee_images)
      })
    </script>
  </body>
</html>
