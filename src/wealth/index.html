<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>World Wealth</title>

    <link rel="stylesheet" href="//cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/chart.css">

</head>
<body>
<br>
<div class="container-fluid dataviz-page">
    <section>
        <div class="row" id="dataset">
            <div class="col-xs-12 col-md-4">

                <div id="explain"></div>

                <table style="border: solid 1px grey; margin: 5px 0;">
                    <thead><tr></tr></thead>
                    <tbody></tbody>
                </table>
                <div class="download_csv_link"><a target="_blank" href="/wealth/WorldWealth.csv">Download CSV</a></div>


            </div>
            <div class="col-xs-12 col-md-offset-2 col-md-8" id="chart"></div>

        </div>
    </section>

</div>

<footer>
    <div class="container">
        <div class="row">
            <p class="col-xs-6">Simple <a href="https://github.com/david-ma/Thalia">Thalia</a> Bootstrap Boilerplate</p>
            <p class="col-xs-6 text-right">By <a href="https://twitter.com/frostickle">@Frostickle</a> <i class="fab fa-twitter" aria-hidden="true"></i></p>
        </div>
    </div>
</footer>

<script src="/js/vendor.min.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script>

<script src="/js/showdown.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="/js/require.js"></script>

<script>

require.config({
	baseUrl: '/js/vendor',
	enforceDefine: true,
	paths: {
		wealth: '/wealth/WorldWealth',
        'datatables.net': "/js/datatables.min",
        chart: "/js/chart"
    },
    shim: {
        chart: ['d3-selection-multi'],
        'd3-selection-multi': ['d3', 'd3-selection', 'd3-transition']
    }
});

require(['chart'], function(chart){

console.log("Hello!");
console.log("Running WorldWealth.ts");

// console.log(_chart);
let Chart = chart.Chart;
let decorateTable = chart.decorateTable;

const charts = [];
let data = [];
const seasons = {};
let dataset = null;

console.log("Calling csv stuff");
d3.csv("/wealth/WorldWealth.csv", function(d, i, columns){
    if(!d.wealth_b) d.wealth_b = 0;
    if(d.region) {
        return d;
    } else {
        return null;
    }

}).then(function(data){
    console.log(data);
    dataset = data;

    console.log("Start async stuff");
    decorateTable(dataset);

    drawChart(dataset);
});


   function drawChart(data) {
    //    const birth = 1905;
    //    const current = 2020;
    //    const age = current - birth;


console.log("Hey,,,,");
console.log(data);

    //    console.log(age);

       const war = new Chart({
           element: "chart",
           data: data,
           nav: false,
           title: "Years of life spent at war"
       }).scratchpad(function(c){
console.log('scratch..');

        const   svg = c.plot,
                   width = c.innerWidth,
                   height = c.innerHeight;

        svg.append("line")
            .attr('x1', width * .15)
            .attr('x2', width * .85)
            .attr('y1', height * .5)
            .attr('y2', height * .5)
            .style('stroke', 'black')
            .style('stroke-width', '2px');

           console.log('heyyy');

           var graphLength = width * .7,
               marginLeft = width * .15;



//            data.forEach(function(d){
//                console.log(d);
//                var startPercent = (d.start - birth) / age,
//                    x = marginLeft + (graphLength * startPercent),
//                    endPercent = d.length / age,
//                    width = graphLength * endPercent;
// console.log(endPercent);
// console.log(graphLength);
// console.log(width);
//                svg.append("rect")
//                    .datum(d)
//                    .attrs({
//                        x: x,
//                        y: height * .55,
//                        width: width,
//                        height: '20'
//                    });
//            });

       });

   }













});
</script>




<script>
const md = new showdown.Converter({
    openLinksInNewWindow: true
});

    $("#explain").html(md.makeHtml(`
# Title
## Originally on source, by @blah.

Do a write up here.`));


</script>

</body>
</html>











